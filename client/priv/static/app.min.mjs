function Se(e,t,r){return e?t:r()}var d=class{withFields(t){let r=Object.keys(this).map(n=>n in t?t[n]:this[n]);return new this.constructor(...r)}},O=class{static fromArray(t,r){let n=r||new Pe;for(let i=t.length-1;i>=0;--i)n=new me(t[i],n);return n}[Symbol.iterator](){return new ur(this)}toArray(){return[...this]}atLeastLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return r!==void 0}hasLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return t===-1&&r instanceof Pe}countLength(){let t=this,r=0;for(;t;)t=t.tail,r++;return r-1}};function w(e,t){return new me(e,t)}function c(e,t){return O.fromArray(e,t)}var ur=class{#e;constructor(t){this.#e=t}next(){if(this.#e instanceof Pe)return{done:!0};{let{head:t,tail:r}=this.#e;return this.#e=r,{value:t,done:!1}}}},Pe=class extends O{},me=class extends O{constructor(t,r){super(),this.head=t,this.tail=r}},he=class{bitSize;byteSize;bitOffset;rawBuffer;constructor(t,r,n){if(!(t instanceof Uint8Array))throw globalThis.Error("BitArray can only be constructed from a Uint8Array");if(this.bitSize=r??t.length*8,this.byteSize=Math.trunc((this.bitSize+7)/8),this.bitOffset=n??0,this.bitSize<0)throw globalThis.Error(`BitArray bit size is invalid: ${this.bitSize}`);if(this.bitOffset<0||this.bitOffset>7)throw globalThis.Error(`BitArray bit offset is invalid: ${this.bitOffset}`);if(t.length!==Math.trunc((this.bitOffset+this.bitSize+7)/8))throw globalThis.Error("BitArray buffer length is invalid");this.rawBuffer=t}byteAt(t){if(!(t<0||t>=this.byteSize))return Ue(this.rawBuffer,this.bitOffset,t)}equals(t){if(this.bitSize!==t.bitSize)return!1;let r=Math.trunc(this.bitSize/8);if(this.bitOffset===0&&t.bitOffset===0){for(let i=0;i<r;i++)if(this.rawBuffer[i]!==t.rawBuffer[i])return!1;let n=this.bitSize%8;if(n){let i=8-n;if(this.rawBuffer[r]>>i!==t.rawBuffer[r]>>i)return!1}}else{for(let i=0;i<r;i++){let s=Ue(this.rawBuffer,this.bitOffset,i),o=Ue(t.rawBuffer,t.bitOffset,i);if(s!==o)return!1}let n=this.bitSize%8;if(n){let i=Ue(this.rawBuffer,this.bitOffset,r),s=Ue(t.rawBuffer,t.bitOffset,r),o=8-n;if(i>>o!==s>>o)return!1}}return!0}get buffer(){if(cn("buffer","Use BitArray.byteAt() or BitArray.rawBuffer instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.buffer does not support unaligned bit arrays");return this.rawBuffer}get length(){if(cn("length","Use BitArray.bitSize or BitArray.byteSize instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.length does not support unaligned bit arrays");return this.rawBuffer.length}};function Ue(e,t,r){if(t===0)return e[r]??0;{let n=e[r]<<t&255,i=e[r+1]>>8-t;return n|i}}var _t=class{constructor(t){this.value=t}},fn={};function cn(e,t){fn[e]||(console.warn(`Deprecated BitArray.${e} property used in JavaScript FFI code. ${t}.`),fn[e]=!0)}var ve=class e extends d{static isResult(t){return t instanceof e}},h=class extends ve{constructor(t){super(),this[0]=t}isOk(){return!0}},_=class extends ve{constructor(t){super(),this[0]=t}isOk(){return!1}};function k(e,t){let r=[e,t];for(;r.length;){let n=r.pop(),i=r.pop();if(n===i)continue;if(!pn(n)||!pn(i)||!Xi(n,i)||Gi(n,i)||Hi(n,i)||Vi(n,i)||Ji(n,i)||Yi(n,i)||Ki(n,i))return!1;let o=Object.getPrototypeOf(n);if(o!==null&&typeof o.equals=="function")try{if(n.equals(i))continue;return!1}catch{}let[u,l]=Ri(n);for(let f of u(n))r.push(l(n,f),l(i,f))}return!0}function Ri(e){if(e instanceof Map)return[t=>t.keys(),(t,r)=>t.get(r)];{let t=e instanceof globalThis.Error?["message"]:[];return[r=>[...t,...Object.keys(r)],(r,n)=>r[n]]}}function Gi(e,t){return e instanceof Date&&(e>t||e<t)}function Hi(e,t){return!(e instanceof he)&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT&&!(e.byteLength===t.byteLength&&e.every((r,n)=>r===t[n]))}function Vi(e,t){return Array.isArray(e)&&e.length!==t.length}function Ji(e,t){return e instanceof Map&&e.size!==t.size}function Yi(e,t){return e instanceof Set&&(e.size!=t.size||[...e].some(r=>!t.has(r)))}function Ki(e,t){return e instanceof RegExp&&(e.source!==t.source||e.flags!==t.flags)}function pn(e){return typeof e=="object"&&e!==null}function Xi(e,t){return typeof e!="object"&&typeof t!="object"&&(!e||!t)||[Promise,WeakSet,WeakMap,Function].some(n=>e instanceof n)?!1:e.constructor===t.constructor}function De(e,t,r,n,i,s){let o=new globalThis.Error(i);o.gleam_error=e,o.module=t,o.line=r,o.function=n,o.fn=n;for(let u in s)o[u]=s[u];return o}var m=class extends d{constructor(t){super(),this[0]=t}},$=class extends d{};function Re(e,t){if(e instanceof m){let r=e[0];return new h(r)}else return new _(t)}function dn(e,t){return e instanceof m?e[0]:t}function Ae(e,t,r){return mn(t,r,e)}function Qi(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=w(i,n)}}}function Zi(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return Qi(n,c([]));{let i=r.head[0];e=r.tail,t=w(i,n)}}}function ar(e){return Zi($t(e),c([]))}function is(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=w(i,n)}}}function F(e){return is(e,c([]))}function ss(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return F(s);{let o=n.head;e=n.tail,t=i,r=w(i(o),s)}}}function E(e,t){return ss(e,t,c([]))}function os(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=w(i,n)}}}function we(e,t){return os(F(e),t)}function xe(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return i;{let o=n.head;e=n.tail,t=s(i,o),r=s}}}function ls(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(i.hasLength(0))return s;{let l=i.head;e=i.tail,t=o(s,l,u),r=o,n=u+1}}}function fr(e,t,r){return ls(e,t,r,0)}function ge(e,t){if(e.isOk()){let r=e[0];return new h(t(r))}else{let r=e[0];return new _(r)}}function wt(e,t){if(e.isOk()){let r=e[0];return new h(r)}else{let r=e[0];return new _(t(r))}}function Ke(e,t){if(e.isOk()){let r=e[0];return t(r)}else{let r=e[0];return new _(r)}}function W(e,t){return Ke(e,t)}var fe=class extends d{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}};function hs(e,t){return wt(e,r=>E(r,t))}function xn(e){return _r(e)}function gn(e){return t=>{if(e.hasLength(0))return new _(c([new fe("another type",M(t),c([]))]));{let r=e.head,n=e.tail,i=r(t);if(i.isOk()){let s=i[0];return new h(s)}else return gn(n)(t)}}}function _s(e,t){let r=t,n=gn(c([_r,o=>ge(yn(o),C)])),i=(()=>{let o=n(r);if(o.isOk())return o[0];{let u=c(["<",M(r),">"]),l=se(u);return l}})(),s=e;return new fe(s.expected,s.found,w(i,e.path))}function hr(e,t){return r=>{let n=new fe("field","nothing",c([]));return Ke(bn(r,e),i=>{let o=Re(i,c([n])),u=Ke(o,t);return hs(u,l=>_s(l,e))})}}var kn=new WeakMap,$r=new DataView(new ArrayBuffer(8)),wr=0;function xr(e){let t=kn.get(e);if(t!==void 0)return t;let r=wr++;return wr===2147483647&&(wr=0),kn.set(e,r),r}function gr(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function br(e){let t=0,r=e.length;for(let n=0;n<r;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function Ln(e){$r.setFloat64(0,e);let t=$r.getInt32(0),r=$r.getInt32(4);return Math.imul(73244475,t>>16^t)^r}function $s(e){return br(e.toString())}function ws(e){let t=Object.getPrototypeOf(e);if(t!==null&&typeof t.hashCode=="function")try{let n=e.hashCode(e);if(typeof n=="number")return n}catch{}if(e instanceof Promise||e instanceof WeakSet||e instanceof WeakMap)return xr(e);if(e instanceof Date)return Ln(e.getTime());let r=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||e instanceof Uint8Array)for(let n=0;n<e.length;n++)r=Math.imul(31,r)+U(e[n])|0;else if(e instanceof Set)e.forEach(n=>{r=r+U(n)|0});else if(e instanceof Map)e.forEach((n,i)=>{r=r+gr(U(n),U(i))|0});else{let n=Object.keys(e);for(let i=0;i<n.length;i++){let s=n[i],o=e[s];r=r+gr(U(o),br(s))|0}}return r}function U(e){if(e===null)return 1108378658;if(e===void 0)return 1108378659;if(e===!0)return 1108378657;if(e===!1)return 1108378656;switch(typeof e){case"number":return Ln(e);case"string":return br(e);case"bigint":return $s(e);case"object":return ws(e);case"symbol":return xr(e);case"function":return xr(e);default:return 0}}var K=5,kr=Math.pow(2,K),xs=kr-1,gs=kr/2,ys=kr/4,B=0,Y=1,N=2,be=3,Or={type:N,bitmap:0,array:[]};function Qe(e,t){return e>>>t&xs}function gt(e,t){return 1<<Qe(e,t)}function bs(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Lr(e,t){return bs(e&t-1)}function P(e,t,r){let n=e.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=e[s];return i[t]=r,i}function ks(e,t,r){let n=e.length,i=new Array(n+1),s=0,o=0;for(;s<t;)i[o++]=e[s++];for(i[o++]=r;s<n;)i[o++]=e[s++];return i}function yr(e,t){let r=e.length,n=new Array(r-1),i=0,s=0;for(;i<t;)n[s++]=e[i++];for(++i;i<r;)n[s++]=e[i++];return n}function Sn(e,t,r,n,i,s){let o=U(t);if(o===n)return{type:be,hash:o,array:[{type:B,k:t,v:r},{type:B,k:i,v:s}]};let u={val:!1};return Ze(Sr(Or,e,o,t,r,u),e,n,i,s,u)}function Ze(e,t,r,n,i,s){switch(e.type){case Y:return Os(e,t,r,n,i,s);case N:return Sr(e,t,r,n,i,s);case be:return Ls(e,t,r,n,i,s)}}function Os(e,t,r,n,i,s){let o=Qe(r,t),u=e.array[o];if(u===void 0)return s.val=!0,{type:Y,size:e.size+1,array:P(e.array,o,{type:B,k:n,v:i})};if(u.type===B)return k(n,u.k)?i===u.v?e:{type:Y,size:e.size,array:P(e.array,o,{type:B,k:n,v:i})}:(s.val=!0,{type:Y,size:e.size,array:P(e.array,o,Sn(t+K,u.k,u.v,r,n,i))});let l=Ze(u,t+K,r,n,i,s);return l===u?e:{type:Y,size:e.size,array:P(e.array,o,l)}}function Sr(e,t,r,n,i,s){let o=gt(r,t),u=Lr(e.bitmap,o);if(e.bitmap&o){let l=e.array[u];if(l.type!==B){let p=Ze(l,t+K,r,n,i,s);return p===l?e:{type:N,bitmap:e.bitmap,array:P(e.array,u,p)}}let f=l.k;return k(n,f)?i===l.v?e:{type:N,bitmap:e.bitmap,array:P(e.array,u,{type:B,k:n,v:i})}:(s.val=!0,{type:N,bitmap:e.bitmap,array:P(e.array,u,Sn(t+K,f,l.v,r,n,i))})}else{let l=e.array.length;if(l>=gs){let f=new Array(32),p=Qe(r,t);f[p]=Sr(Or,t+K,r,n,i,s);let a=0,g=e.bitmap;for(let T=0;T<32;T++){if(g&1){let q=e.array[a++];f[T]=q}g=g>>>1}return{type:Y,size:l+1,array:f}}else{let f=ks(e.array,u,{type:B,k:n,v:i});return s.val=!0,{type:N,bitmap:e.bitmap|o,array:f}}}}function Ls(e,t,r,n,i,s){if(r===e.hash){let o=vr(e,n);if(o!==-1)return e.array[o].v===i?e:{type:be,hash:r,array:P(e.array,o,{type:B,k:n,v:i})};let u=e.array.length;return s.val=!0,{type:be,hash:r,array:P(e.array,u,{type:B,k:n,v:i})}}return Ze({type:N,bitmap:gt(e.hash,t),array:[e]},t,r,n,i,s)}function vr(e,t){let r=e.array.length;for(let n=0;n<r;n++)if(k(t,e.array[n].k))return n;return-1}function xt(e,t,r,n){switch(e.type){case Y:return Ss(e,t,r,n);case N:return vs(e,t,r,n);case be:return As(e,n)}}function Ss(e,t,r,n){let i=Qe(r,t),s=e.array[i];if(s!==void 0){if(s.type!==B)return xt(s,t+K,r,n);if(k(n,s.k))return s}}function vs(e,t,r,n){let i=gt(r,t);if(!(e.bitmap&i))return;let s=Lr(e.bitmap,i),o=e.array[s];if(o.type!==B)return xt(o,t+K,r,n);if(k(n,o.k))return o}function As(e,t){let r=vr(e,t);if(!(r<0))return e.array[r]}function Ar(e,t,r,n){switch(e.type){case Y:return zs(e,t,r,n);case N:return js(e,t,r,n);case be:return Es(e,n)}}function zs(e,t,r,n){let i=Qe(r,t),s=e.array[i];if(s===void 0)return e;let o;if(s.type===B){if(!k(s.k,n))return e}else if(o=Ar(s,t+K,r,n),o===s)return e;if(o===void 0){if(e.size<=ys){let u=e.array,l=new Array(e.size-1),f=0,p=0,a=0;for(;f<i;){let g=u[f];g!==void 0&&(l[p]=g,a|=1<<f,++p),++f}for(++f;f<u.length;){let g=u[f];g!==void 0&&(l[p]=g,a|=1<<f,++p),++f}return{type:N,bitmap:a,array:l}}return{type:Y,size:e.size-1,array:P(e.array,i,o)}}return{type:Y,size:e.size,array:P(e.array,i,o)}}function js(e,t,r,n){let i=gt(r,t);if(!(e.bitmap&i))return e;let s=Lr(e.bitmap,i),o=e.array[s];if(o.type!==B){let u=Ar(o,t+K,r,n);return u===o?e:u!==void 0?{type:N,bitmap:e.bitmap,array:P(e.array,s,u)}:e.bitmap===i?void 0:{type:N,bitmap:e.bitmap^i,array:yr(e.array,s)}}return k(n,o.k)?e.bitmap===i?void 0:{type:N,bitmap:e.bitmap^i,array:yr(e.array,s)}:e}function Es(e,t){let r=vr(e,t);if(r<0)return e;if(e.array.length!==1)return{type:be,hash:e.hash,array:yr(e.array,r)}}function vn(e,t){if(e===void 0)return;let r=e.array,n=r.length;for(let i=0;i<n;i++){let s=r[i];if(s!==void 0){if(s.type===B){t(s.v,s.k);continue}vn(s,t)}}}var X=class e{static fromObject(t){let r=Object.keys(t),n=e.new();for(let i=0;i<r.length;i++){let s=r[i];n=n.set(s,t[s])}return n}static fromMap(t){let r=e.new();return t.forEach((n,i)=>{r=r.set(i,n)}),r}static new(){return new e(void 0,0)}constructor(t,r){this.root=t,this.size=r}get(t,r){if(this.root===void 0)return r;let n=xt(this.root,0,U(t),t);return n===void 0?r:n.v}set(t,r){let n={val:!1},i=this.root===void 0?Or:this.root,s=Ze(i,0,U(t),t,r,n);return s===this.root?this:new e(s,n.val?this.size+1:this.size)}delete(t){if(this.root===void 0)return this;let r=Ar(this.root,0,U(t),t);return r===this.root?this:r===void 0?e.new():new e(r,this.size-1)}has(t){return this.root===void 0?!1:xt(this.root,0,U(t),t)!==void 0}entries(){if(this.root===void 0)return[];let t=[];return this.forEach((r,n)=>t.push([n,r])),t}forEach(t){vn(this.root,t)}hashCode(){let t=0;return this.forEach((r,n)=>{t=t+gr(U(r),U(n))|0}),t}equals(t){if(!(t instanceof e)||this.size!==t.size)return!1;try{return this.forEach((r,n)=>{if(!k(t.get(n,!r),r))throw On}),!0}catch(r){if(r===On)return!1;throw r}}},On=Symbol();var zr=void 0,An={};function S(e){return e}function C(e){return e.toString()}function jr(e){let t=e.toString().replace("+","");if(t.indexOf(".")>=0)return t;{let r=t.indexOf("e");return r>=0?t.slice(0,r)+".0"+t.slice(r):t+".0"}}function pr(e,t,r){return typeof e.replaceAll<"u"?e.replaceAll(t,r):e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),r)}function dr(e){let t=qn(e);return t?O.fromArray(Array.from(t).map(r=>r.segment)):O.fromArray(e.match(/./gsu))}var zn;function qn(e){if(globalThis.Intl&&Intl.Segmenter)return zn||=new Intl.Segmenter,zn.segment(e)[Symbol.iterator]()}function yt(e){let t,r=qn(e);return r?t=r.next().value?.segment:t=e.match(/./su)?.[0],t?new h([t,e.slice(t.length)]):new _(zr)}function ke(e){return[e.charCodeAt(0)|0,e.slice(1)]}function R(e){return e.toLowerCase()}function mr(e,t){return O.fromArray(e.split(t))}function oe(e,t){let r=e[Symbol.iterator](),n=r.next().value||"",i=r.next();for(;!i.done;)n=n+t+i.value,i=r.next();return n}function se(e){let t="";for(let r of e)t=t+r;return t}function z(e,t,r){return e.slice(t,t+r)}function Er(e,t){return e.startsWith(t)}function et(e,t){let r=e.indexOf(t);if(r>=0){let n=e.slice(0,r),i=e.slice(r+t.length);return new h([n,i])}else return new _(zr)}var Cn=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),Zl=new RegExp(`^[${Cn}]*`),eu=new RegExp(`[${Cn}]*$`);function v(e){console.log(e)}function V(){return X.new()}function $t(e){return O.fromArray(e.entries())}function Ge(e,t){let r=e.get(t,An);return r===An?new _(zr):new h(r)}function mn(e,t,r){return r.set(e,t)}function M(e){if(typeof e=="string")return"String";if(typeof e=="boolean")return"Bool";if(e instanceof ve)return"Result";if(e instanceof O)return"List";if(e instanceof he)return"BitArray";if(e instanceof X)return"Dict";if(Number.isInteger(e))return"Int";if(Array.isArray(e))return`Tuple of ${e.length} elements`;if(typeof e=="number")return"Float";if(e===null)return"Null";if(e===void 0)return"Nil";{let t=typeof e;return t.charAt(0).toUpperCase()+t.slice(1)}}function Br(e,t){return Bs(e,M(t))}function Bs(e,t){return new _(O.fromArray([new fe(e,t,O.fromArray([]))]))}function _r(e){return typeof e=="string"?new h(e):Br("String",e)}function yn(e){return Number.isInteger(e)?new h(e):Br("Int",e)}function bn(e,t){let r=()=>Br("Dict",e);if(e instanceof X||e instanceof WeakMap||e instanceof Map){let n=Ge(e,t);return new h(n.isOk()?new m(n[0]):new $)}else return e===null?r():Object.getPrototypeOf(e)==Object.prototype?jn(e,t,()=>new h(new $)):jn(e,t,r)}function jn(e,t,r){try{return t in e?new h(new m(e[t])):r()}catch{return r()}}function Q(e){let t=typeof e;if(e===!0)return"True";if(e===!1)return"False";if(e===null)return"//js(null)";if(e===void 0)return"Nil";if(t==="string")return qs(e);if(t==="bigint"||Number.isInteger(e))return e.toString();if(t==="number")return jr(e);if(Array.isArray(e))return`#(${e.map(Q).join(", ")})`;if(e instanceof O)return Is(e);if(e instanceof _t)return Ws(e);if(e instanceof he)return`<<${Tn(e,"")}>>`;if(e instanceof d)return Ns(e);if(e instanceof X)return Cs(e);if(e instanceof Set)return`//js(Set(${[...e].map(Q).join(", ")}))`;if(e instanceof RegExp)return`//js(${e})`;if(e instanceof Date)return`//js(Date("${e.toISOString()}"))`;if(e instanceof Function){let r=[];for(let n of Array(e.length).keys())r.push(String.fromCharCode(n+97));return`//fn(${r.join(", ")}) { ... }`}return Ts(e)}function qs(e){let t='"';for(let r=0;r<e.length;r++){let n=e[r];switch(n){case`
`:t+="\\n";break;case"\r":t+="\\r";break;case"	":t+="\\t";break;case"\f":t+="\\f";break;case"\\":t+="\\\\";break;case'"':t+='\\"';break;default:n<" "||n>"~"&&n<"\xA0"?t+="\\u{"+n.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":t+=n}}return t+='"',t}function Cs(e){let t="dict.from_list([",r=!0;return e.forEach((n,i)=>{r||(t=t+", "),t=t+"#("+Q(i)+", "+Q(n)+")",r=!1}),t+"])"}function Ts(e){let t=Object.getPrototypeOf(e)?.constructor?.name||"Object",r=[];for(let s of Object.keys(e))r.push(`${Q(s)}: ${Q(e[s])}`);let n=r.length?" "+r.join(", ")+" ":"";return`//js(${t==="Object"?"":t+" "}{${n}})`}function Ns(e){let t=Object.keys(e).map(r=>{let n=Q(e[r]);return isNaN(parseInt(r))?`${r}: ${n}`:n}).join(", ");return t?`${e.constructor.name}(${t})`:e.constructor.name}function Is(e){return`[${e.toArray().map(Q).join(", ")}]`}function Ws(e){return`//utfcodepoint(${String.fromCodePoint(e.value)})`}function Tn(e,t){if(e.bitSize===0)return t;for(let r=0;r<e.byteSize-1;r++)t+=e.byteAt(r).toString(),t+=", ";if(e.byteSize*8===e.bitSize)t+=e.byteAt(e.byteSize-1).toString();else{let r=e.bitSize%8;t+=e.byteAt(e.byteSize-1)>>8-r,t+=`:size(${r})`}return t}function qr(e,t,r){let i=e,s=pr(i,t,r);return s}function Cr(e){let r=se(e);return r}function Tr(e,t){for(;;){let r=e,n=t;if(n>0){let s=yt(r);if(s.isOk())e=s[0][1],t=n-1;else return r}else return r}}function Oe(e,t){if(t==="")return dr(e);{let n=e,i=mr(n,t);return E(i,S)}}function tt(e){let t=Q(e);return t}function Un(e,t){if(e instanceof X||e instanceof WeakMap||e instanceof Map){let n={},i=e.get(t,n);return i===n?new h(new $):new h(new m(i))}let r=Number.isInteger(t);if(r&&t>=0&&t<8&&e instanceof O){let n=0;for(let i of e){if(n===t)return new h(new m(i));n++}return new _("Indexable")}return r&&Array.isArray(e)||e&&typeof e=="object"||e&&Object.getPrototypeOf(e)===Object.prototype?t in e?new h(new m(e[t])):new h(new $):new _(r?"Indexable":"Dict")}function Pn(e,t,r,n,i){if(!(e instanceof O||Array.isArray(e))){let o=new ce("List",M(e),i);return[i,O.fromArray([o])]}let s=[];for(let o of e){let u=t(o),[l,f]=u;if(f instanceof me){let[p,a]=r(u,n.toString());return[i,a]}s.push(l),n++}return[O.fromArray(s),i]}function Dn(e){return Number.isInteger(e)?new h(e):new _(0)}function Fn(e){return typeof e=="string"?new h(e):new _(0)}var ce=class extends d{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}},le=class extends d{constructor(t){super(),this.function=t}};function Ir(e,t){let r=t.function(e),n=r[0],i=r[1];return i.hasLength(0)?new h(n):new _(i)}function Rn(e){return new le(t=>[e,c([])])}function Hs(e,t){return new le(r=>{let n=e.function(r),i=n[0],s=n[1];return[t(i),s]})}function Vs(e,t,r){for(;;){let n=e,i=t,s=r;if(s.hasLength(0))return i;{let o=s.head,u=s.tail,l=o.function(n),f=l;if(l[1].hasLength(0))return f;e=n,t=i,r=u}}}function Js(e,t){return new le(r=>{let n=e.function(r),i=n;return n[1].hasLength(0)?i:Vs(r,i,t)})}function Gn(e,t,r){let n=r(e);return n.isOk()?[n[0],c([])]:[n[0],c([new ce(t,M(e),c([]))])]}function Ys(e){return Gn(e,"Int",Dn)}var kt=new le(Ys);function Ks(e){return Gn(e,"String",Fn)}var ze=new le(Ks);function Hn(e){return new le(t=>Pn(t,e.function,(r,n)=>bt(r,c([n])),0,c([])))}function bt(e,t){let r=Js(ze,c([Hs(kt,C)])),n=E(t,s=>{let o=s,u=Ir(o,r);return u.isOk()?u[0]:"<"+M(o)+">"}),i=E(e[1],s=>{let o=s;return new ce(o.expected,o.found,we(n,s.path))});return[e[0],i]}function Xs(e,t,r,n,i){for(;;){let s=e,o=t,u=r,l=n,f=i;if(s.hasLength(0)){let p=u(l);return bt(p,F(o))}else{let p=s.head,a=s.tail,g=Un(l,p);if(g.isOk()&&g[0]instanceof m){let T=g[0][0];e=a,t=w(p,o),r=u,n=T,i=f}else{if(g.isOk()&&g[0]instanceof $)return f(l,w(p,o));{let T=g[0],mt=[u(l)[0],c([new ce(T,M(l),c([]))])];return bt(mt,F(o))}}}}}function Qs(e,t,r){return new le(n=>{let i=Xs(e,c([]),t.function,n,(p,a)=>{let q=[t.function(p)[0],c([new ce("Field","Nothing",c([]))])];return bt(q,F(a))}),s=i[0],o=i[1],u=r(s).function(n),l=u[0],f=u[1];return[l,we(o,f)]})}function Le(e,t,r){return Qs(c([e]),t,r)}var x=class extends d{constructor(t,r,n,i,s,o,u){super(),this.scheme=t,this.userinfo=r,this.host=n,this.port=i,this.path=s,this.query=o,this.fragment=u}};function ro(e){return 48>=e&&e<=57||65>=e&&e<=90||97>=e&&e<=122||e===58||e===46}function ee(e,t){return new h((()=>{let r=t;return new x(r.scheme,r.userinfo,r.host,r.port,r.path,r.query,new m(e))})())}function no(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s.startsWith("#")&&u===0){let l=s.slice(1);return ee(l,o)}else if(s.startsWith("#")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(a.scheme,a.userinfo,a.host,a.port,a.path,new m(f),a.fragment)})();return ee(l,p)}else{if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,l.host,l.port,l.path,new m(i),l.fragment)})());{let f=ke(s)[1];e=i,t=f,r=o,n=u+1}}}}function pe(e,t){return no(e,e,t,0)}function io(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s.startsWith("?")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(a.scheme,a.userinfo,a.host,a.port,f,a.query,a.fragment)})();return pe(l,p)}else if(s.startsWith("#")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(a.scheme,a.userinfo,a.host,a.port,f,a.query,a.fragment)})();return ee(l,p)}else{if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,l.host,l.port,i,l.query,l.fragment)})());{let f=ke(s)[1];e=i,t=f,r=o,n=u+1}}}}function Ee(e,t){return io(e,e,t,0)}function Z(e,t,r){for(;;){let n=e,i=t,s=r;if(n.startsWith("0"))e=n.slice(1),t=i,r=s*10;else if(n.startsWith("1"))e=n.slice(1),t=i,r=s*10+1;else if(n.startsWith("2"))e=n.slice(1),t=i,r=s*10+2;else if(n.startsWith("3"))e=n.slice(1),t=i,r=s*10+3;else if(n.startsWith("4"))e=n.slice(1),t=i,r=s*10+4;else if(n.startsWith("5"))e=n.slice(1),t=i,r=s*10+5;else if(n.startsWith("6"))e=n.slice(1),t=i,r=s*10+6;else if(n.startsWith("7"))e=n.slice(1),t=i,r=s*10+7;else if(n.startsWith("8"))e=n.slice(1),t=i,r=s*10+8;else if(n.startsWith("9"))e=n.slice(1),t=i,r=s*10+9;else if(n.startsWith("?")){let o=n.slice(1),u=(()=>{let l=i;return new x(l.scheme,l.userinfo,l.host,new m(s),l.path,l.query,l.fragment)})();return pe(o,u)}else if(n.startsWith("#")){let o=n.slice(1),u=(()=>{let l=i;return new x(l.scheme,l.userinfo,l.host,new m(s),l.path,l.query,l.fragment)})();return ee(o,u)}else if(n.startsWith("/")){let o=(()=>{let u=i;return new x(u.scheme,u.userinfo,u.host,new m(s),u.path,u.query,u.fragment)})();return Ee(n,o)}else return n===""?new h((()=>{let o=i;return new x(o.scheme,o.userinfo,o.host,new m(s),o.path,o.query,o.fragment)})()):new _(void 0)}}function Ot(e,t){if(e.startsWith(":0")){let r=e.slice(2);return Z(r,t,0)}else if(e.startsWith(":1")){let r=e.slice(2);return Z(r,t,1)}else if(e.startsWith(":2")){let r=e.slice(2);return Z(r,t,2)}else if(e.startsWith(":3")){let r=e.slice(2);return Z(r,t,3)}else if(e.startsWith(":4")){let r=e.slice(2);return Z(r,t,4)}else if(e.startsWith(":5")){let r=e.slice(2);return Z(r,t,5)}else if(e.startsWith(":6")){let r=e.slice(2);return Z(r,t,6)}else if(e.startsWith(":7")){let r=e.slice(2);return Z(r,t,7)}else if(e.startsWith(":8")){let r=e.slice(2);return Z(r,t,8)}else if(e.startsWith(":9")){let r=e.slice(2);return Z(r,t,9)}else{if(e.startsWith(":"))return new _(void 0);if(e.startsWith("?")){let r=e.slice(1);return pe(r,t)}else if(e.startsWith("#")){let r=e.slice(1);return ee(r,t)}else return e.startsWith("/")?Ee(e,t):e===""?new h(t):new _(void 0)}}function Jn(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,new m(i),l.port,l.path,l.query,l.fragment)})());if(s.startsWith(":")){let l=z(i,0,u),f=(()=>{let p=o;return new x(p.scheme,p.userinfo,new m(l),p.port,p.path,p.query,p.fragment)})();return Ot(s,f)}else if(s.startsWith("/")){let l=z(i,0,u),f=(()=>{let p=o;return new x(p.scheme,p.userinfo,new m(l),p.port,p.path,p.query,p.fragment)})();return Ee(s,f)}else if(s.startsWith("?")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(a.scheme,a.userinfo,new m(f),a.port,a.path,a.query,a.fragment)})();return pe(l,p)}else if(s.startsWith("#")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(a.scheme,a.userinfo,new m(f),a.port,a.path,a.query,a.fragment)})();return ee(l,p)}else{let f=ke(s)[1];e=i,t=f,r=o,n=u+1}}}function so(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,new m(s),l.port,l.path,l.query,l.fragment)})());if(s.startsWith("]")&&u===0){let l=s.slice(1);return Ot(l,o)}else if(s.startsWith("]")){let l=s.slice(1),f=z(i,0,u+1),p=(()=>{let a=o;return new x(a.scheme,a.userinfo,new m(f),a.port,a.path,a.query,a.fragment)})();return Ot(l,p)}else{if(s.startsWith("/")&&u===0)return Ee(s,o);if(s.startsWith("/")){let l=z(i,0,u),f=(()=>{let p=o;return new x(p.scheme,p.userinfo,new m(l),p.port,p.path,p.query,p.fragment)})();return Ee(s,f)}else if(s.startsWith("?")&&u===0){let l=s.slice(1);return pe(l,o)}else if(s.startsWith("?")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(a.scheme,a.userinfo,new m(f),a.port,a.path,a.query,a.fragment)})();return pe(l,p)}else if(s.startsWith("#")&&u===0){let l=s.slice(1);return ee(l,o)}else if(s.startsWith("#")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(a.scheme,a.userinfo,new m(f),a.port,a.path,a.query,a.fragment)})();return ee(l,p)}else{let l=ke(s),f=l[0],p=l[1];if(ro(f))e=i,t=p,r=o,n=u+1;else return Jn(i,i,o,0)}}}}function oo(e,t){return so(e,e,t,0)}function lo(e,t){return Jn(e,e,t,0)}function je(e,t){if(e.startsWith("["))return oo(e,t);if(e.startsWith(":")){let r=(()=>{let n=t;return new x(n.scheme,n.userinfo,new m(""),n.port,n.path,n.query,n.fragment)})();return Ot(e,r)}else return e===""?new h((()=>{let r=t;return new x(r.scheme,r.userinfo,new m(""),r.port,r.path,r.query,r.fragment)})()):lo(e,t)}function uo(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s.startsWith("@")&&u===0){let l=s.slice(1);return je(l,o)}else if(s.startsWith("@")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(a.scheme,new m(f),a.host,a.port,a.path,a.query,a.fragment)})();return je(l,p)}else{if(s==="")return je(i,o);if(s.startsWith("/"))return je(i,o);if(s.startsWith("?"))return je(i,o);if(s.startsWith("#"))return je(i,o);{let f=ke(s)[1];e=i,t=f,r=o,n=u+1}}}}function ao(e,t){return uo(e,e,t,0)}function Wr(e,t){if(e==="//")return new h((()=>{let r=t;return new x(r.scheme,r.userinfo,new m(""),r.port,r.path,r.query,r.fragment)})());if(e.startsWith("//")){let r=e.slice(2);return ao(r,t)}else return Ee(e,t)}function fo(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s.startsWith("/")&&u===0)return Wr(s,o);if(s.startsWith("/")){let l=z(i,0,u),f=(()=>{let p=o;return new x(new m(R(l)),p.userinfo,p.host,p.port,p.path,p.query,p.fragment)})();return Wr(s,f)}else if(s.startsWith("?")&&u===0){let l=s.slice(1);return pe(l,o)}else if(s.startsWith("?")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(new m(R(f)),a.userinfo,a.host,a.port,a.path,a.query,a.fragment)})();return pe(l,p)}else if(s.startsWith("#")&&u===0){let l=s.slice(1);return ee(l,o)}else if(s.startsWith("#")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(new m(R(f)),a.userinfo,a.host,a.port,a.path,a.query,a.fragment)})();return ee(l,p)}else{if(s.startsWith(":")&&u===0)return new _(void 0);if(s.startsWith(":")){let l=s.slice(1),f=z(i,0,u),p=(()=>{let a=o;return new x(new m(R(f)),a.userinfo,a.host,a.port,a.path,a.query,a.fragment)})();return Wr(l,p)}else{if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,l.host,l.port,i,l.query,l.fragment)})());{let f=ke(s)[1];e=i,t=f,r=o,n=u+1}}}}}function Lt(e){let t=(()=>{let u=e.fragment;if(u instanceof m){let l=u[0];return c(["#",l])}else return c([])})(),r=(()=>{let u=e.query;if(u instanceof m){let l=u[0];return w("?",w(l,t))}else return t})(),n=w(e.path,r),i=(()=>{let u=e.host,l=Er(e.path,"/");if(u instanceof m&&!l&&u[0]!==""){let f=u[0];return w("/",n)}else return n})(),s=(()=>{let u=e.host,l=e.port;if(u instanceof m&&l instanceof m){let f=l[0];return w(":",w(C(f),i))}else return i})(),o=(()=>{let u=e.scheme,l=e.userinfo,f=e.host;if(u instanceof m&&l instanceof m&&f instanceof m){let p=u[0],a=l[0],g=f[0];return w(p,w("://",w(a,w("@",w(g,s)))))}else if(u instanceof m&&l instanceof $&&f instanceof m){let p=u[0],a=f[0];return w(p,w("://",w(a,s)))}else if(u instanceof m&&l instanceof m&&f instanceof $){let p=u[0];return w(p,w(":",s))}else if(u instanceof m&&l instanceof $&&f instanceof $){let p=u[0];return w(p,w(":",s))}else if(u instanceof $&&l instanceof $&&f instanceof m){let p=f[0];return w("//",w(p,s))}else return s})();return Cr(o)}var co=new x(new $,new $,new $,new $,"",new $,new $);function Yn(e){return fo(e,e,co,0)}function Kn(e){try{let t=JSON.parse(e);return new h(t)}catch(t){return new _(ho(t,e))}}function ho(e,t){return _o(e)?new vt:$o(e,t)}function _o(e){return/((unexpected (end|eof))|(end of data)|(unterminated string)|(json( parse error|\.parse)\: expected '(\:|\}|\])'))/i.test(e.message)}function $o(e,t){let r=[wo,xo,yo,go];for(let n of r){let i=n(e,t);if(i)return i}return new de("",0)}function wo(e){let r=/unexpected token '(.)', ".+" is not valid JSON/i.exec(e.message);if(!r)return null;let n=St(r[1]);return new de(n,-1)}function xo(e){let r=/unexpected token (.) in JSON at position (\d+)/i.exec(e.message);if(!r)return null;let n=St(r[1]),i=Number(r[2]);return new de(n,i)}function go(e,t){let n=/(unexpected character|expected .*) at line (\d+) column (\d+)/i.exec(e.message);if(!n)return null;let i=Number(n[2]),s=Number(n[3]),o=bo(i,s,t),u=St(t[o]);return new de(u,o)}function yo(e){let r=/unexpected (identifier|token) "(.)"/i.exec(e.message);if(!r)return null;let n=St(r[2]);return new de(n,0)}function St(e){return"0x"+e.charCodeAt(0).toString(16).toUpperCase()}function bo(e,t,r){if(e===1)return t-1;let n=1,i=0;return r.split("").find((s,o)=>(s===`
`&&(n+=1),n===e?(i=o+t,!0):!1)),i}var vt=class extends d{},de=class extends d{constructor(t){super(),this[0]=t}};var Mr=class extends d{constructor(t){super(),this[0]=t}};function Oo(e,t){return W(Kn(e),r=>{let n=Ir(r,t);return wt(n,i=>new Mr(i))})}function Xn(e,t){return Oo(e,t)}var At=class extends d{constructor(t){super(),this.all=t}};function Qn(e){return new At(c([t=>e(t.dispatch,t.emit,t.select,t.root)]))}function zt(e){return Qn((t,r,n,i)=>e(t))}function te(){return new At(c([]))}var qe=class extends d{constructor(t){super(),this.content=t}},A=class extends d{constructor(t,r,n,i,s,o,u){super(),this.key=t,this.namespace=r,this.tag=n,this.attrs=i,this.children=s,this.self_closing=o,this.void=u}},rt=class extends d{constructor(t){super(),this.subtree=t}},Ce=class extends d{constructor(t,r,n){super(),this[0]=t,this[1]=r,this.as_property=n}},nt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}};function jo(e){if(e instanceof Ce)return new _(void 0);{let t=e[0],r=e[1],n=Tr(t,2);return new h([n,r])}}function Eo(e,t,r){return fr(e,t,(n,i,s)=>{let o=r+"-"+C(s);return Zn(i,n,o)})}function Zn(e,t,r){for(;;){let n=e,i=t,s=r;if(n instanceof qe)return i;if(n instanceof rt){let o=n.subtree;e=o(),t=i,r=s}else{let o=n.attrs,u=n.children,l=xe(o,i,(f,p)=>{let a=jo(p);if(a.isOk()){let g=a[0][0],T=a[0][1];return Ae(f,s+"-"+g,T)}else return f});return Eo(u,l,s)}}}function ei(e){return Zn(e,V(),"0")}function it(e,t){return new Ce(e,t,!1)}function ri(e,t){return new nt("on"+e,t)}function re(e){return it("style",xe(e,"",(t,r)=>{let n=r[0],i=r[1];return t+n+":"+i+";"}))}function ni(e){return it("type",e)}function ii(e){return it("value",e)}function si(e){return it("placeholder",e)}function oi(e){return it("href",e)}function ue(e,t,r){return e==="area"?new A("","",e,t,c([]),!1,!0):e==="base"?new A("","",e,t,c([]),!1,!0):e==="br"?new A("","",e,t,c([]),!1,!0):e==="col"?new A("","",e,t,c([]),!1,!0):e==="embed"?new A("","",e,t,c([]),!1,!0):e==="hr"?new A("","",e,t,c([]),!1,!0):e==="img"?new A("","",e,t,c([]),!1,!0):e==="input"?new A("","",e,t,c([]),!1,!0):e==="link"?new A("","",e,t,c([]),!1,!0):e==="meta"?new A("","",e,t,c([]),!1,!0):e==="param"?new A("","",e,t,c([]),!1,!0):e==="source"?new A("","",e,t,c([]),!1,!0):e==="track"?new A("","",e,t,c([]),!1,!0):e==="wbr"?new A("","",e,t,c([]),!1,!0):new A("","",e,t,r,!1,!1)}function G(e){return new qe(e)}var Fr=class extends d{constructor(t){super(),this.dict=t}};function ui(){return new Fr(V())}var jt=class extends d{constructor(t){super(),this[0]=t}},Et=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},Bt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}};function ai(e){return k(e.created,V())&&k(e.removed,ui())&&k(e.updated,V())}var qt=class extends d{constructor(t){super(),this[0]=t}},Ct=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},st=class extends d{constructor(t){super(),this[0]=t}},ne=class extends d{constructor(t){super(),this[0]=t}},ot=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},Tt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}};var lt=class extends d{},Nt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},It=class extends d{constructor(t){super(),this[0]=t}},Wt=class extends d{constructor(t){super(),this[0]=t}};globalThis.customElements&&!globalThis.customElements.get("lustre-fragment")&&globalThis.customElements.define("lustre-fragment",class extends HTMLElement{constructor(){super()}});function Rr(e,t,r){let n,i=[{prev:e,next:t,parent:e.parentNode}];for(;i.length;){let{prev:s,next:o,parent:u}=i.pop();for(;o.subtree!==void 0;)o=o.subtree();if(o.content!==void 0)if(s)if(s.nodeType===Node.TEXT_NODE)s.textContent!==o.content&&(s.textContent=o.content),n??=s;else{let l=document.createTextNode(o.content);u.replaceChild(l,s),n??=l}else{let l=document.createTextNode(o.content);u.appendChild(l),n??=l}else if(o.tag!==void 0){let l=No({prev:s,next:o,dispatch:r,stack:i});s?s!==l&&u.replaceChild(l,s):u.appendChild(l),n??=l}}return n}function No({prev:e,next:t,dispatch:r,stack:n}){let i=t.namespace||"http://www.w3.org/1999/xhtml",s=e&&e.nodeType===Node.ELEMENT_NODE&&e.localName===t.tag&&e.namespaceURI===(t.namespace||"http://www.w3.org/1999/xhtml"),o=s?e:i?document.createElementNS(i,t.tag):document.createElement(t.tag),u;if(ut.has(o))u=ut.get(o);else{let y=new Map;ut.set(o,y),u=y}let l=s?new Set(u.keys()):null,f=s?new Set(Array.from(e.attributes,y=>y.name)):null,p=null,a=null,g=null;if(s&&t.tag==="textarea"){let y=t.children[Symbol.iterator]().next().value?.content;y!==void 0&&(o.value=y)}let T=[];for(let y of t.attrs){let b=y[0],j=y[1];if(y.as_property)o[b]!==j&&(o[b]=j),s&&f.delete(b);else if(b.startsWith("on")){let H=b.slice(2),lr=r(j,H==="input");u.has(H)||o.addEventListener(H,at),u.set(H,lr),s&&l.delete(H)}else if(b.startsWith("data-lustre-on-")){let H=b.slice(15),lr=r(Io);u.has(H)||o.addEventListener(H,at),u.set(H,lr),o.setAttribute(b,j),s&&(l.delete(H),f.delete(b))}else b.startsWith("delegate:data-")||b.startsWith("delegate:aria-")?(o.setAttribute(b,j),T.push([b.slice(10),j])):b==="class"?p=p===null?j:p+" "+j:b==="style"?a=a===null?j:a+j:b==="dangerous-unescaped-html"?g=j:(o.getAttribute(b)!==j&&o.setAttribute(b,j),(b==="value"||b==="selected")&&(o[b]=j),s&&f.delete(b))}if(p!==null&&(o.setAttribute("class",p),s&&f.delete("class")),a!==null&&(o.setAttribute("style",a),s&&f.delete("style")),s){for(let y of f)o.removeAttribute(y);for(let y of l)u.delete(y),o.removeEventListener(y,at)}if(t.tag==="slot"&&window.queueMicrotask(()=>{for(let y of o.assignedElements())for(let[b,j]of T)y.hasAttribute(b)||y.setAttribute(b,j)}),t.key!==void 0&&t.key!=="")o.setAttribute("data-lustre-key",t.key);else if(g!==null)return o.innerHTML=g,o;let q=o.firstChild,sr=null,mt=null,an=null,or=Mt(t).next().value;if(s&&or!==void 0&&or.key!==void 0&&or.key!==""){sr=new Set,mt=fi(e),an=fi(t);for(let y of Mt(t))q=Wo(q,y,o,n,an,mt,sr)}else for(let y of Mt(t))n.unshift({prev:q,next:y,parent:o}),q=q?.nextSibling;for(;q;){let y=q.nextSibling;o.removeChild(q),q=y}return o}var ut=new WeakMap;function at(e){let t=e.currentTarget;if(!ut.has(t)){t.removeEventListener(e.type,at);return}let r=ut.get(t);if(!r.has(e.type)){t.removeEventListener(e.type,at);return}r.get(e.type)(e)}function Io(e){let t=e.currentTarget,r=t.getAttribute(`data-lustre-on-${e.type}`),n=JSON.parse(t.getAttribute("data-lustre-data")||"{}"),i=JSON.parse(t.getAttribute("data-lustre-include")||"[]");switch(e.type){case"input":case"change":i.push("target.value");break}return{tag:r,data:i.reduce((s,o)=>{let u=o.split(".");for(let l=0,f=s,p=e;l<u.length;l++)l===u.length-1?f[u[l]]=p[u[l]]:(f[u[l]]??={},p=p[u[l]],f=f[u[l]]);return s},{data:n})}}function fi(e){let t=new Map;if(e)for(let r of Mt(e)){let n=r?.key||r?.getAttribute?.("data-lustre-key");n&&t.set(n,r)}return t}function Wo(e,t,r,n,i,s,o){for(;e&&!i.has(e.getAttribute("data-lustre-key"));){let l=e.nextSibling;r.removeChild(e),e=l}if(s.size===0)return n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e;if(o.has(t.key))return console.warn(`Duplicate key found in Lustre vnode: ${t.key}`),n.unshift({prev:null,next:t,parent:r}),e;o.add(t.key);let u=s.get(t.key);if(!u&&!e)return n.unshift({prev:null,next:t,parent:r}),e;if(!u&&e!==null){let l=document.createTextNode("");return r.insertBefore(l,e),n.unshift({prev:l,next:t,parent:r}),e}return!u||u===e?(n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e):(r.insertBefore(u,e),n.unshift({prev:u,next:t,parent:r}),e)}function*Mt(e){for(let t of e.children)yield*ci(t)}function*ci(e){e.subtree!==void 0?yield*ci(e.subtree()):yield e}var Gr=class e{static start({init:t,update:r,view:n},i,s){if(!ft())return new _(new ct);let o=i instanceof HTMLElement?i:document.querySelector(i);if(!o)return new _(new Ut(i));let u=new e(o,t(s),r,n);return new h(l=>u.send(l))}constructor(t,[r,n],i,s){this.root=t,this.#e=r,this.#s=i,this.#r=s,this.#t=window.setTimeout(()=>this.#n(n.all.toArray(),!0),0)}root;send(t){if(t instanceof st){if(t[0]instanceof Wt){this.#t=window.clearTimeout(this.#t),this.#i=[],this.#e=t[0][0];let r=this.#r(this.#e),n=(s,o=!1)=>u=>{let l=s(u);l instanceof h&&this.send(new ne(l[0],o))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));Rr(i,r,n)}}else if(t instanceof ne){let r=t[0],n=t[1]??!1;this.#i.push(r),n?(this.#t=window.clearTimeout(this.#t),this.#n()):this.#t||(this.#t=window.setTimeout(()=>this.#n()))}else if(t instanceof ot){let r=t[0],n=t[1];this.root.dispatchEvent(new CustomEvent(r,{detail:n,bubbles:!0,composed:!0}))}else if(t instanceof lt)for(this.#t=window.clearTimeout(this.#t),this.#e=null,this.#s=null,this.#r=null,this.#i=null;this.root.firstChild;)this.root.firstChild.remove()}#e;#s;#r;#i=[];#t;#n(t=[]){this.#t=void 0,this.#o(t);let r=this.#r(this.#e),n=(s,o=!1)=>u=>{let l=s(u);l instanceof h&&this.send(new ne(l[0],o))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));Rr(i,r,n)}#o(t=[]){for(;this.#i.length>0;){let r=this.#i.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;){let r=t.shift(),n=u=>this.send(new ne(u)),i=(u,l)=>this.root.dispatchEvent(new CustomEvent(u,{detail:l,bubbles:!0,composed:!0})),s=()=>{},o=this.root;r({dispatch:n,emit:i,select:s,root:o})}this.#i.length>0&&this.#o(t)}},pi=Gr.start;var Hr=class e{static start({init:t,update:r,view:n,on_attribute_change:i},s){let o=new e(t(s),r,n,i);return new h(u=>o.send(u))}constructor([t,r],n,i,s){this.#e=t,this.#s=n,this.#i=i,this.#t=i(t),this.#u=s,this.#n=new Map,this.#o=ei(this.#t),this.#l(r.all.toArray())}send(t){if(t instanceof qt){for(let r of t[0]){let n=this.#u.get(r[0]);if(!n)continue;let i=n(r[1]);i instanceof _||this.#r.push(i)}this.#l()}else if(t instanceof Ct)this.#r=this.#r.concat(t[0].toArray()),this.#l(t[1].all.toArray());else if(!(t instanceof st))if(t instanceof ne)this.#r.push(t[0]),this.#l();else if(t instanceof ot){let r=new Et(t[0],t[1]);for(let[n,i]of this.#n)i(r)}else if(t instanceof Tt){let r=this.#o.get(t[0]);if(!r)return;let n=r(t[1]);if(n instanceof _)return;this.#r.push(n[0]),this.#l()}else if(t instanceof Nt){let r=ar(this.#u),n=new Bt(r,this.#t);this.#n=this.#n.set(t[0],t[1]),t[1](n)}else t instanceof It&&(this.#n=this.#n.delete(t[0]))}#e;#s;#r;#i;#t;#n;#o;#u;#l(t=[]){this.#a(t);let r=this.#i(this.#e),n=elements(this.#t,r);if(!ai(n)){let i=new jt(n);for(let[s,o]of this.#n)o(i)}this.#t=r,this.#o=n.handlers}#a(t=[]){for(;this.#r.length>0;){let r=this.#r.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;)t.shift()({dispatch:u=>this.send(new ne(u)),emit:(u,l)=>this.root.dispatchEvent(new CustomEvent(u,{detail:l,bubbles:!0,composed:!0})),select:()=>{},root:null});this.#r.length>0&&this.#a(t)}},Mo=Hr.start,ft=()=>globalThis.window&&window.document;var Vr=class extends d{constructor(t,r,n,i){super(),this.init=t,this.update=r,this.view=n,this.on_attribute_change=i}};var Ut=class extends d{constructor(t){super(),this.selector=t}},ct=class extends d{};function di(e,t,r){return new Vr(e,t,r,new $)}function mi(e,t,r){return Se(!ft(),new _(new ct),()=>pi(e,t,r))}function _i(e,t){return ue("h3",e,t)}function Te(e,t){return ue("div",e,t)}function Pt(e,t){return ue("p",e,t)}function $i(e,t){return ue("pre",e,t)}function wi(e,t){return ue("a",e,t)}function xi(e,t){return ue("button",e,t)}function gi(e){return ue("input",e,c([]))}function yi(e,t){return ri(e,t)}function bi(e){return yi("click",t=>new h(e))}function Po(e){let t=e;return hr("target",hr("value",xn))(t)}function ki(e){return yi("input",t=>{let r=Po(t);return ge(r,e)})}var Ne=class extends d{},pt=class extends d{},Dt=class extends d{},Ft=class extends d{},Rt=class extends d{},Gt=class extends d{},Ht=class extends d{},Vt=class extends d{},Jt=class extends d{};var Yt=class extends d{},dt=class extends d{};function Oi(e){return e instanceof Ht?"connect":e instanceof Rt?"delete":e instanceof Ne?"get":e instanceof Dt?"head":e instanceof Vt?"options":e instanceof Jt?"patch":e instanceof pt?"post":e instanceof Ft?"put":e instanceof Gt?"trace":e[0]}function Li(e){return e instanceof Yt?"http":"https"}function Si(e){let t=R(e);return t==="http"?new h(new Yt):t==="https"?new h(new dt):new _(void 0)}var Yr=class extends d{constructor(t,r,n,i,s,o,u,l){super(),this.method=t,this.headers=r,this.body=n,this.scheme=i,this.host=s,this.port=o,this.path=u,this.query=l}};function Ai(e){return new x(new m(Li(e.scheme)),new $,new m(e.host),e.port,e.path,e.query,new $)}function Vo(e){return W((()=>{let t=e.scheme,r=dn(t,"");return Si(r)})(),t=>W((()=>{let r=e.host;return Re(r,void 0)})(),r=>{let n=new Yr(new Ne,c([]),"",t,r,e.port,e.path,e.query);return new h(n)}))}function zi(e){let r=Yn(e);return W(r,Vo)}var ae=class extends d{constructor(t,r,n){super(),this.status=t,this.headers=r,this.body=n}};var Ie=class e{constructor(t){this.promise=t}static wrap(t){return t instanceof Promise?new e(t):t}static unwrap(t){return t instanceof e?t.promise:t}};function Kt(e){return Promise.resolve(Ie.wrap(e))}function ji(e,t){return e.then(r=>t(Ie.unwrap(r)))}function Xt(e,t){return e.then(r=>Ie.wrap(t(Ie.unwrap(r))))}function Kr(e,t){return e.catch(r=>t(r))}function Ei(e,t){return Xt(e,n=>(t(n),n))}function Qt(e,t){return ji(e,n=>{if(n.isOk()){let i=n[0];return t(i)}else{let i=n[0];return Kt(new _(i))}})}async function qi(e){try{return new h(await fetch(e))}catch(t){return new _(new Zt(t.toString()))}}function Ci(e){return new ae(e.status,O.fromArray([...e.headers]),e)}function Ti(e){let t=Lt(Ai(e)),r=Oi(e.method).toUpperCase(),n={headers:Ko(e.headers),method:r};return r!=="GET"&&r!=="HEAD"&&(n.body=e.body),new globalThis.Request(t,n)}function Ko(e){let t=new globalThis.Headers;for(let[r,n]of e)t.append(r.toLowerCase(),n);return t}async function Xr(e){let t;try{t=await e.body.text()}catch{return new _(new er)}return new h(e.withFields({body:t}))}var Zt=class extends d{constructor(t){super(),this[0]=t}},er=class extends d{};function Ni(e){let r=Ti(e),n=qi(r);return Qt(n,i=>Kt(new h(Ci(i))))}var Qr=class extends d{constructor(t){super(),this[0]=t}},Zr=class extends d{constructor(t){super(),this[0]=t}},en=class extends d{constructor(t){super(),this[0]=t}},tr=class extends d{},tn=class extends d{},rn=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},nn=class extends d{},sn=class extends d{constructor(t){super(),this.run=t}};function Qo(e,t,r){let n=Ni(e),i=Qt(n,Xr),s=Xt(i,u=>{if(u.isOk()){let l=u[0];return t.run(new h(l))}else return t.run(new _(new tr))}),o=Kr(s,u=>t.run(new _(new tr)));Ei(o,r)}function Ii(e,t){return zt(r=>{let n=zi(e);if(n.isOk()){let i=n[0];return Qo(i,t,r)}else return r(t.run(new _(new Qr(e))))})}function Zo(e){if(e instanceof ae&&200<=e.status&&e.status<=299){let t=e.status,r=e.body;return new h(r)}else{if(e instanceof ae&&e.status===401)return new _(new nn);if(e instanceof ae&&e.status===404)return new _(new tn);if(e instanceof ae&&e.status===500){let t=e.body;return new _(new Zr(t))}else{let t=e.status,r=e.body;return new _(new rn(t,r))}}}function Wi(e,t){return new sn(r=>{let i=W(r,Zo),s=W(i,o=>{let u=Xn(o,e);if(u.isOk()){let l=u[0];return new h(l)}else{let l=u[0];return new _(new en(l))}});return t(s)})}var Mi=window?.location?.href,on=()=>Mi?new h(tl(new URL(Mi))):new _(void 0);var Ui=e=>{window.history.pushState({},"",Lt(e)),window.requestAnimationFrame(()=>{e.fragment[0]&&document.getElementById(e.fragment[0])?.scrollIntoView()}),window.dispatchEvent(new CustomEvent("modem-push",{detail:e}))};var tl=e=>new x(e.protocol?new m(e.protocol.slice(0,-1)):new $,new $,e.hostname?new m(e.hostname):new $,e.port?new m(Number(e.port)):new $,e.pathname,e.search?new m(e.search.slice(1)):new $,e.hash?new m(e.hash.slice(1)):new $);var nl=new x(new $,new $,new $,new $,"",new $,new $);function Pi(e,t,r){return zt(n=>Se(!ft(),void 0,()=>Ui((()=>{let i=nl;return new x(i.scheme,i.userinfo,i.host,i.port,e,t,r)})())))}var ln=class extends d{constructor(t,r,n,i,s,o){super(),this.id=t,this.track_name=r,this.artist_name=n,this.album_name=i,this.duration=s,this.plain_lyrics=o}},D=class extends d{constructor(t,r,n){super(),this.search_url=t,this.tracks=r,this.error=n}},rr=class extends d{constructor(t){super(),this[0]=t}},nr=class extends d{},ir=class extends d{constructor(t){super(),this[0]=t}};function un(e){let t=Oe(e,"/");if(v("URL parts: "+oe(t,", ")),t.atLeastLength(5)&&t.tail.tail.tail.head==="track"){let r=t.tail.tail.tail.tail.head,n=Oe(r,"?");if(v("ID parts: "+oe(n,", ")),n.atLeastLength(1)){let i=n.head;return v("Found track ID: "+i),new m(i)}else return v("No ID found in parts"),new $}else return v("URL doesn't match expected format"),new $}function sl(){return Le("id",kt,e=>Le("trackName",ze,t=>Le("artistName",ze,r=>Le("albumName",ze,n=>Le("duration",kt,i=>Le("plainLyrics",ze,s=>Rn(new ln(e,t,r,n,i,s))))))))}function Di(e){let t="http://localhost:3000/track/"+e;v("Making API request to: "+t);let r=Hn(sl()),n=Wi(r,i=>new ir(i));return Ii(t,n)}function ol(e){v("Initializing app...");let t=on();if(v("Initial URL: "+tt(t)),t.isOk()){let r=t[0];v("URI path: "+r.path),v("URI query: "+tt(r.query));let n=r.query;if(n instanceof m){let i=n[0];v("Query string: "+i);let s=et(i,"=");if(s.isOk()&&s[0][0]==="q"){let o=s[0][1];v("Found URL in query: "+o);let u=un(o);if(u instanceof m){let l=u[0];return v("Found track ID: "+l),[new D(o,c([]),new $),Di(l)]}else return v("No valid track ID found"),[new D("",c([]),new $),te()]}else return v("Query doesn't match expected format"),[new D("",c([]),new $),te()]}else return v("No query parameter found"),[new D("",c([]),new $),te()]}else return v("Failed to get initial URL"),[new D("",c([]),new $),te()]}function ll(e,t){if(t instanceof rr){let r=t[0],n=un(r);if(n instanceof m){let i=n[0];return[(()=>{let s=e;return new D(r,s.tracks,s.error)})(),Di(i)]}else return[(()=>{let i=e;return new D(r,i.tracks,i.error)})(),te()]}else if(t instanceof nr){let r=un(e.search_url);if(r instanceof m){let n=r[0],i=qr(e.search_url,"/","%2F");return[e,Pi("/search",new m("q="+i),new $)]}else return[(()=>{let n=e;return new D(n.search_url,n.tracks,new m("Invalid Spotify URL"))})(),te()]}else if(t instanceof ir&&t[0].isOk()){let r=t[0][0];return[(()=>{let n=e;return new D(n.search_url,r,new $)})(),te()]}else return[(()=>{let r=e;return new D(r.search_url,r.tracks,new m("Failed to fetch tracks"))})(),te()]}function ul(e){let t=c([["padding","20px"]]),r=c([["margin-bottom","20px"]]),n=c([["padding","8px"],["margin-right","10px"],["width","300px"]]),i=c([["padding","8px 16px"]]),s=c([["color","red"],["margin-bottom","10px"]]),o=c([["margin-bottom","20px"],["padding","10px"],["border","1px solid #ccc"],["border-radius","4px"]]),u=c([["white-space","pre-wrap"]]);return Te(c([re(t)]),c([Te(c([re(r)]),c([gi(c([ni("text"),si("Enter Spotify URL"),ii(e.search_url),ki(l=>new rr(l)),re(n)])),xi(c([bi(new nr),re(i)]),c([G("Search")]))])),(()=>{let l=e.error;if(l instanceof m){let f=l[0];return Te(c([re(s)]),c([G(f)]))}else return G("")})(),Te(c([]),E(e.tracks,l=>{let f="plecoapi://x-callback-url/s?q="+l.plain_lyrics;return Te(c([re(o)]),c([_i(c([]),c([G(l.track_name)])),Pt(c([]),c([G("Artist: "+l.artist_name)])),Pt(c([]),c([G("Album: "+l.album_name)])),Pt(c([]),c([G("Duration: "+C(l.duration)+" seconds")])),wi(c([oi(f),re(c([["color","blue"],["text-decoration","underline"]]))]),c([G("Open in Pleco")])),$i(c([re(u)]),c([G(l.plain_lyrics)]))]))}))]))}function Fi(){let e=di(ol,ll,ul),t=mi(e,"#app",void 0);if(!t.isOk())throw De("let_assert","app",20,"main","Pattern match failed, no pattern matched the value.",{value:t})}Fi();
