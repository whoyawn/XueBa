var d=class{withFields(t){let r=Object.keys(this).map(n=>n in t?t[n]:this[n]);return new this.constructor(...r)}},L=class{static fromArray(t,r){let n=r||new De;for(let i=t.length-1;i>=0;--i)n=new _e(t[i],n);return n}[Symbol.iterator](){return new fr(this)}toArray(){return[...this]}atLeastLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return r!==void 0}hasLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return t===-1&&r instanceof De}countLength(){let t=this,r=0;for(;t;)t=t.tail,r++;return r-1}};function w(e,t){return new _e(e,t)}function c(e,t){return L.fromArray(e,t)}var fr=class{#e;constructor(t){this.#e=t}next(){if(this.#e instanceof De)return{done:!0};{let{head:t,tail:r}=this.#e;return this.#e=r,{value:t,done:!1}}}},De=class extends L{},_e=class extends L{constructor(t,r){super(),this.head=t,this.tail=r}},$e=class{bitSize;byteSize;bitOffset;rawBuffer;constructor(t,r,n){if(!(t instanceof Uint8Array))throw globalThis.Error("BitArray can only be constructed from a Uint8Array");if(this.bitSize=r??t.length*8,this.byteSize=Math.trunc((this.bitSize+7)/8),this.bitOffset=n??0,this.bitSize<0)throw globalThis.Error(`BitArray bit size is invalid: ${this.bitSize}`);if(this.bitOffset<0||this.bitOffset>7)throw globalThis.Error(`BitArray bit offset is invalid: ${this.bitOffset}`);if(t.length!==Math.trunc((this.bitOffset+this.bitSize+7)/8))throw globalThis.Error("BitArray buffer length is invalid");this.rawBuffer=t}byteAt(t){if(!(t<0||t>=this.byteSize))return Pe(this.rawBuffer,this.bitOffset,t)}equals(t){if(this.bitSize!==t.bitSize)return!1;let r=Math.trunc(this.bitSize/8);if(this.bitOffset===0&&t.bitOffset===0){for(let i=0;i<r;i++)if(this.rawBuffer[i]!==t.rawBuffer[i])return!1;let n=this.bitSize%8;if(n){let i=8-n;if(this.rawBuffer[r]>>i!==t.rawBuffer[r]>>i)return!1}}else{for(let i=0;i<r;i++){let s=Pe(this.rawBuffer,this.bitOffset,i),o=Pe(t.rawBuffer,t.bitOffset,i);if(s!==o)return!1}let n=this.bitSize%8;if(n){let i=Pe(this.rawBuffer,this.bitOffset,r),s=Pe(t.rawBuffer,t.bitOffset,r),o=8-n;if(i>>o!==s>>o)return!1}}return!0}get buffer(){if(pn("buffer","Use BitArray.byteAt() or BitArray.rawBuffer instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.buffer does not support unaligned bit arrays");return this.rawBuffer}get length(){if(pn("length","Use BitArray.bitSize or BitArray.byteSize instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.length does not support unaligned bit arrays");return this.rawBuffer.length}};function Pe(e,t,r){if(t===0)return e[r]??0;{let n=e[r]<<t&255,i=e[r+1]>>8-t;return n|i}}var _t=class{constructor(t){this.value=t}},cn={};function pn(e,t){cn[e]||(console.warn(`Deprecated BitArray.${e} property used in JavaScript FFI code. ${t}.`),cn[e]=!0)}var Se=class e extends d{static isResult(t){return t instanceof e}},h=class extends Se{constructor(t){super(),this[0]=t}isOk(){return!0}},_=class extends Se{constructor(t){super(),this[0]=t}isOk(){return!1}};function k(e,t){let r=[e,t];for(;r.length;){let n=r.pop(),i=r.pop();if(n===i)continue;if(!dn(n)||!dn(i)||!Zi(n,i)||Hi(n,i)||Vi(n,i)||Ji(n,i)||Yi(n,i)||Ki(n,i)||Xi(n,i))return!1;let o=Object.getPrototypeOf(n);if(o!==null&&typeof o.equals=="function")try{if(n.equals(i))continue;return!1}catch{}let[u,l]=Gi(n);for(let a of u(n))r.push(l(n,a),l(i,a))}return!0}function Gi(e){if(e instanceof Map)return[t=>t.keys(),(t,r)=>t.get(r)];{let t=e instanceof globalThis.Error?["message"]:[];return[r=>[...t,...Object.keys(r)],(r,n)=>r[n]]}}function Hi(e,t){return e instanceof Date&&(e>t||e<t)}function Vi(e,t){return!(e instanceof $e)&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT&&!(e.byteLength===t.byteLength&&e.every((r,n)=>r===t[n]))}function Ji(e,t){return Array.isArray(e)&&e.length!==t.length}function Yi(e,t){return e instanceof Map&&e.size!==t.size}function Ki(e,t){return e instanceof Set&&(e.size!=t.size||[...e].some(r=>!t.has(r)))}function Xi(e,t){return e instanceof RegExp&&(e.source!==t.source||e.flags!==t.flags)}function dn(e){return typeof e=="object"&&e!==null}function Zi(e,t){return typeof e!="object"&&typeof t!="object"&&(!e||!t)||[Promise,WeakSet,WeakMap,Function].some(n=>e instanceof n)?!1:e.constructor===t.constructor}function Re(e,t,r,n,i,s){let o=new globalThis.Error(i);o.gleam_error=e,o.module=t,o.line=r,o.function=n,o.fn=n;for(let u in s)o[u]=s[u];return o}var m=class extends d{constructor(t){super(),this[0]=t}},$=class extends d{};function Ge(e,t){if(e instanceof m){let r=e[0];return new h(r)}else return new _(t)}function mn(e,t){return e instanceof m?e[0]:t}function ve(e,t,r){return hn(t,r,e)}function Qi(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=w(i,n)}}}function es(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return Qi(n,c([]));{let i=r.head[0];e=r.tail,t=w(i,n)}}}function cr(e){return es($t(e),c([]))}function ss(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=w(i,n)}}}function F(e){return ss(e,c([]))}function os(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return F(s);{let o=n.head;e=n.tail,t=i,r=w(i(o),s)}}}function q(e,t){return os(e,t,c([]))}function ls(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=w(i,n)}}}function fe(e,t){return ls(F(e),t)}function ce(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return i;{let o=n.head;e=n.tail,t=s(i,o),r=s}}}function us(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(i.hasLength(0))return s;{let l=i.head;e=i.tail,t=o(s,l,u),r=o,n=u+1}}}function pr(e,t,r){return us(e,t,r,0)}function ge(e,t){if(e.isOk()){let r=e[0];return new h(t(r))}else{let r=e[0];return new _(r)}}function wt(e,t){if(e.isOk()){let r=e[0];return new h(r)}else{let r=e[0];return new _(t(r))}}function Xe(e,t){if(e.isOk()){let r=e[0];return t(r)}else{let r=e[0];return new _(r)}}function U(e,t){return Xe(e,t)}var pe=class extends d{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}};function _s(e,t){return wt(e,r=>q(r,t))}function gn(e){return wr(e)}function yn(e){return t=>{if(e.hasLength(0))return new _(c([new pe("another type",P(t),c([]))]));{let r=e.head,n=e.tail,i=r(t);if(i.isOk()){let s=i[0];return new h(s)}else return yn(n)(t)}}}function $s(e,t){let r=t,n=yn(c([wr,o=>ge(bn(o),T)])),i=(()=>{let o=n(r);if(o.isOk())return o[0];{let u=c(["<",P(r),">"]),l=se(u);return l}})(),s=e;return new pe(s.expected,s.found,w(i,e.path))}function $r(e,t){return r=>{let n=new pe("field","nothing",c([]));return Xe(kn(r,e),i=>{let o=Ge(i,c([n])),u=Xe(o,t);return _s(u,l=>$s(l,e))})}}var On=new WeakMap,xr=new DataView(new ArrayBuffer(8)),gr=0;function yr(e){let t=On.get(e);if(t!==void 0)return t;let r=gr++;return gr===2147483647&&(gr=0),On.set(e,r),r}function br(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function Or(e){let t=0,r=e.length;for(let n=0;n<r;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function Sn(e){xr.setFloat64(0,e);let t=xr.getInt32(0),r=xr.getInt32(4);return Math.imul(73244475,t>>16^t)^r}function ws(e){return Or(e.toString())}function xs(e){let t=Object.getPrototypeOf(e);if(t!==null&&typeof t.hashCode=="function")try{let n=e.hashCode(e);if(typeof n=="number")return n}catch{}if(e instanceof Promise||e instanceof WeakSet||e instanceof WeakMap)return yr(e);if(e instanceof Date)return Sn(e.getTime());let r=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||e instanceof Uint8Array)for(let n=0;n<e.length;n++)r=Math.imul(31,r)+D(e[n])|0;else if(e instanceof Set)e.forEach(n=>{r=r+D(n)|0});else if(e instanceof Map)e.forEach((n,i)=>{r=r+br(D(n),D(i))|0});else{let n=Object.keys(e);for(let i=0;i<n.length;i++){let s=n[i],o=e[s];r=r+br(D(o),Or(s))|0}}return r}function D(e){if(e===null)return 1108378658;if(e===void 0)return 1108378659;if(e===!0)return 1108378657;if(e===!1)return 1108378656;switch(typeof e){case"number":return Sn(e);case"string":return Or(e);case"bigint":return ws(e);case"object":return xs(e);case"symbol":return yr(e);case"function":return yr(e);default:return 0}}var X=5,Lr=Math.pow(2,X),gs=Lr-1,ys=Lr/2,bs=Lr/4,B=0,K=1,I=2,be=3,Sr={type:I,bitmap:0,array:[]};function Qe(e,t){return e>>>t&gs}function gt(e,t){return 1<<Qe(e,t)}function ks(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function vr(e,t){return ks(e&t-1)}function R(e,t,r){let n=e.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=e[s];return i[t]=r,i}function Os(e,t,r){let n=e.length,i=new Array(n+1),s=0,o=0;for(;s<t;)i[o++]=e[s++];for(i[o++]=r;s<n;)i[o++]=e[s++];return i}function kr(e,t){let r=e.length,n=new Array(r-1),i=0,s=0;for(;i<t;)n[s++]=e[i++];for(++i;i<r;)n[s++]=e[i++];return n}function vn(e,t,r,n,i,s){let o=D(t);if(o===n)return{type:be,hash:o,array:[{type:B,k:t,v:r},{type:B,k:i,v:s}]};let u={val:!1};return et(Ar(Sr,e,o,t,r,u),e,n,i,s,u)}function et(e,t,r,n,i,s){switch(e.type){case K:return Ls(e,t,r,n,i,s);case I:return Ar(e,t,r,n,i,s);case be:return Ss(e,t,r,n,i,s)}}function Ls(e,t,r,n,i,s){let o=Qe(r,t),u=e.array[o];if(u===void 0)return s.val=!0,{type:K,size:e.size+1,array:R(e.array,o,{type:B,k:n,v:i})};if(u.type===B)return k(n,u.k)?i===u.v?e:{type:K,size:e.size,array:R(e.array,o,{type:B,k:n,v:i})}:(s.val=!0,{type:K,size:e.size,array:R(e.array,o,vn(t+X,u.k,u.v,r,n,i))});let l=et(u,t+X,r,n,i,s);return l===u?e:{type:K,size:e.size,array:R(e.array,o,l)}}function Ar(e,t,r,n,i,s){let o=gt(r,t),u=vr(e.bitmap,o);if(e.bitmap&o){let l=e.array[u];if(l.type!==B){let p=et(l,t+X,r,n,i,s);return p===l?e:{type:I,bitmap:e.bitmap,array:R(e.array,u,p)}}let a=l.k;return k(n,a)?i===l.v?e:{type:I,bitmap:e.bitmap,array:R(e.array,u,{type:B,k:n,v:i})}:(s.val=!0,{type:I,bitmap:e.bitmap,array:R(e.array,u,vn(t+X,a,l.v,r,n,i))})}else{let l=e.array.length;if(l>=ys){let a=new Array(32),p=Qe(r,t);a[p]=Ar(Sr,t+X,r,n,i,s);let f=0,g=e.bitmap;for(let N=0;N<32;N++){if(g&1){let C=e.array[f++];a[N]=C}g=g>>>1}return{type:K,size:l+1,array:a}}else{let a=Os(e.array,u,{type:B,k:n,v:i});return s.val=!0,{type:I,bitmap:e.bitmap|o,array:a}}}}function Ss(e,t,r,n,i,s){if(r===e.hash){let o=zr(e,n);if(o!==-1)return e.array[o].v===i?e:{type:be,hash:r,array:R(e.array,o,{type:B,k:n,v:i})};let u=e.array.length;return s.val=!0,{type:be,hash:r,array:R(e.array,u,{type:B,k:n,v:i})}}return et({type:I,bitmap:gt(e.hash,t),array:[e]},t,r,n,i,s)}function zr(e,t){let r=e.array.length;for(let n=0;n<r;n++)if(k(t,e.array[n].k))return n;return-1}function xt(e,t,r,n){switch(e.type){case K:return vs(e,t,r,n);case I:return As(e,t,r,n);case be:return zs(e,n)}}function vs(e,t,r,n){let i=Qe(r,t),s=e.array[i];if(s!==void 0){if(s.type!==B)return xt(s,t+X,r,n);if(k(n,s.k))return s}}function As(e,t,r,n){let i=gt(r,t);if(!(e.bitmap&i))return;let s=vr(e.bitmap,i),o=e.array[s];if(o.type!==B)return xt(o,t+X,r,n);if(k(n,o.k))return o}function zs(e,t){let r=zr(e,t);if(!(r<0))return e.array[r]}function jr(e,t,r,n){switch(e.type){case K:return js(e,t,r,n);case I:return Es(e,t,r,n);case be:return qs(e,n)}}function js(e,t,r,n){let i=Qe(r,t),s=e.array[i];if(s===void 0)return e;let o;if(s.type===B){if(!k(s.k,n))return e}else if(o=jr(s,t+X,r,n),o===s)return e;if(o===void 0){if(e.size<=bs){let u=e.array,l=new Array(e.size-1),a=0,p=0,f=0;for(;a<i;){let g=u[a];g!==void 0&&(l[p]=g,f|=1<<a,++p),++a}for(++a;a<u.length;){let g=u[a];g!==void 0&&(l[p]=g,f|=1<<a,++p),++a}return{type:I,bitmap:f,array:l}}return{type:K,size:e.size-1,array:R(e.array,i,o)}}return{type:K,size:e.size,array:R(e.array,i,o)}}function Es(e,t,r,n){let i=gt(r,t);if(!(e.bitmap&i))return e;let s=vr(e.bitmap,i),o=e.array[s];if(o.type!==B){let u=jr(o,t+X,r,n);return u===o?e:u!==void 0?{type:I,bitmap:e.bitmap,array:R(e.array,s,u)}:e.bitmap===i?void 0:{type:I,bitmap:e.bitmap^i,array:kr(e.array,s)}}return k(n,o.k)?e.bitmap===i?void 0:{type:I,bitmap:e.bitmap^i,array:kr(e.array,s)}:e}function qs(e,t){let r=zr(e,t);if(r<0)return e;if(e.array.length!==1)return{type:be,hash:e.hash,array:kr(e.array,r)}}function An(e,t){if(e===void 0)return;let r=e.array,n=r.length;for(let i=0;i<n;i++){let s=r[i];if(s!==void 0){if(s.type===B){t(s.v,s.k);continue}An(s,t)}}}var Z=class e{static fromObject(t){let r=Object.keys(t),n=e.new();for(let i=0;i<r.length;i++){let s=r[i];n=n.set(s,t[s])}return n}static fromMap(t){let r=e.new();return t.forEach((n,i)=>{r=r.set(i,n)}),r}static new(){return new e(void 0,0)}constructor(t,r){this.root=t,this.size=r}get(t,r){if(this.root===void 0)return r;let n=xt(this.root,0,D(t),t);return n===void 0?r:n.v}set(t,r){let n={val:!1},i=this.root===void 0?Sr:this.root,s=et(i,0,D(t),t,r,n);return s===this.root?this:new e(s,n.val?this.size+1:this.size)}delete(t){if(this.root===void 0)return this;let r=jr(this.root,0,D(t),t);return r===this.root?this:r===void 0?e.new():new e(r,this.size-1)}has(t){return this.root===void 0?!1:xt(this.root,0,D(t),t)!==void 0}entries(){if(this.root===void 0)return[];let t=[];return this.forEach((r,n)=>t.push([n,r])),t}forEach(t){An(this.root,t)}hashCode(){let t=0;return this.forEach((r,n)=>{t=t+br(D(r),D(n))|0}),t}equals(t){if(!(t instanceof e)||this.size!==t.size)return!1;try{return this.forEach((r,n)=>{if(!k(t.get(n,!r),r))throw Ln}),!0}catch(r){if(r===Ln)return!1;throw r}}},Ln=Symbol();var Er=void 0,zn={};function v(e){return e}function T(e){return e.toString()}function qr(e){let t=e.toString().replace("+","");if(t.indexOf(".")>=0)return t;{let r=t.indexOf("e");return r>=0?t.slice(0,r)+".0"+t.slice(r):t+".0"}}function mr(e,t,r){return typeof e.replaceAll<"u"?e.replaceAll(t,r):e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),r)}function hr(e){let t=Cn(e);return t?L.fromArray(Array.from(t).map(r=>r.segment)):L.fromArray(e.match(/./gsu))}var jn;function Cn(e){if(globalThis.Intl&&Intl.Segmenter)return jn||=new Intl.Segmenter,jn.segment(e)[Symbol.iterator]()}function yt(e){let t,r=Cn(e);return r?t=r.next().value?.segment:t=e.match(/./su)?.[0],t?new h([t,e.slice(t.length)]):new _(Er)}function ke(e){return[e.charCodeAt(0)|0,e.slice(1)]}function G(e){return e.toLowerCase()}function _r(e,t){return L.fromArray(e.split(t))}function oe(e,t){let r=e[Symbol.iterator](),n=r.next().value||"",i=r.next();for(;!i.done;)n=n+t+i.value,i=r.next();return n}function se(e){let t="";for(let r of e)t=t+r;return t}function z(e,t,r){return e.slice(t,t+r)}function Br(e,t){return e.startsWith(t)}function Ae(e,t){let r=e.indexOf(t);if(r>=0){let n=e.slice(0,r),i=e.slice(r+t.length);return new h([n,i])}else return new _(Er)}var Tn=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),tu=new RegExp(`^[${Tn}]*`),ru=new RegExp(`[${Tn}]*$`);function O(e){console.log(e)}function J(){return Z.new()}function $t(e){return L.fromArray(e.entries())}function He(e,t){let r=e.get(t,zn);return r===zn?new _(Er):new h(r)}function hn(e,t,r){return r.set(e,t)}function P(e){if(typeof e=="string")return"String";if(typeof e=="boolean")return"Bool";if(e instanceof Se)return"Result";if(e instanceof L)return"List";if(e instanceof $e)return"BitArray";if(e instanceof Z)return"Dict";if(Number.isInteger(e))return"Int";if(Array.isArray(e))return`Tuple of ${e.length} elements`;if(typeof e=="number")return"Float";if(e===null)return"Null";if(e===void 0)return"Nil";{let t=typeof e;return t.charAt(0).toUpperCase()+t.slice(1)}}function Cr(e,t){return Bs(e,P(t))}function Bs(e,t){return new _(L.fromArray([new pe(e,t,L.fromArray([]))]))}function wr(e){return typeof e=="string"?new h(e):Cr("String",e)}function bn(e){return Number.isInteger(e)?new h(e):Cr("Int",e)}function kn(e,t){let r=()=>Cr("Dict",e);if(e instanceof Z||e instanceof WeakMap||e instanceof Map){let n=He(e,t);return new h(n.isOk()?new m(n[0]):new $)}else return e===null?r():Object.getPrototypeOf(e)==Object.prototype?En(e,t,()=>new h(new $)):En(e,t,r)}function En(e,t,r){try{return t in e?new h(new m(e[t])):r()}catch{return r()}}function Q(e){let t=typeof e;if(e===!0)return"True";if(e===!1)return"False";if(e===null)return"//js(null)";if(e===void 0)return"Nil";if(t==="string")return Cs(e);if(t==="bigint"||Number.isInteger(e))return e.toString();if(t==="number")return qr(e);if(Array.isArray(e))return`#(${e.map(Q).join(", ")})`;if(e instanceof L)return Ws(e);if(e instanceof _t)return Ms(e);if(e instanceof $e)return`<<${Nn(e,"")}>>`;if(e instanceof d)return Is(e);if(e instanceof Z)return Ts(e);if(e instanceof Set)return`//js(Set(${[...e].map(Q).join(", ")}))`;if(e instanceof RegExp)return`//js(${e})`;if(e instanceof Date)return`//js(Date("${e.toISOString()}"))`;if(e instanceof Function){let r=[];for(let n of Array(e.length).keys())r.push(String.fromCharCode(n+97));return`//fn(${r.join(", ")}) { ... }`}return Ns(e)}function Cs(e){let t='"';for(let r=0;r<e.length;r++){let n=e[r];switch(n){case`
`:t+="\\n";break;case"\r":t+="\\r";break;case"	":t+="\\t";break;case"\f":t+="\\f";break;case"\\":t+="\\\\";break;case'"':t+='\\"';break;default:n<" "||n>"~"&&n<"\xA0"?t+="\\u{"+n.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":t+=n}}return t+='"',t}function Ts(e){let t="dict.from_list([",r=!0;return e.forEach((n,i)=>{r||(t=t+", "),t=t+"#("+Q(i)+", "+Q(n)+")",r=!1}),t+"])"}function Ns(e){let t=Object.getPrototypeOf(e)?.constructor?.name||"Object",r=[];for(let s of Object.keys(e))r.push(`${Q(s)}: ${Q(e[s])}`);let n=r.length?" "+r.join(", ")+" ":"";return`//js(${t==="Object"?"":t+" "}{${n}})`}function Is(e){let t=Object.keys(e).map(r=>{let n=Q(e[r]);return isNaN(parseInt(r))?`${r}: ${n}`:n}).join(", ");return t?`${e.constructor.name}(${t})`:e.constructor.name}function Ws(e){return`[${e.toArray().map(Q).join(", ")}]`}function Ms(e){return`//utfcodepoint(${String.fromCodePoint(e.value)})`}function Nn(e,t){if(e.bitSize===0)return t;for(let r=0;r<e.byteSize-1;r++)t+=e.byteAt(r).toString(),t+=", ";if(e.byteSize*8===e.bitSize)t+=e.byteAt(e.byteSize-1).toString();else{let r=e.bitSize%8;t+=e.byteAt(e.byteSize-1)>>8-r,t+=`:size(${r})`}return t}function Tr(e,t,r){let i=e,s=mr(i,t,r);return s}function Nr(e){let r=se(e);return r}function Ir(e,t){for(;;){let r=e,n=t;if(n>0){let s=yt(r);if(s.isOk())e=s[0][1],t=n-1;else return r}else return r}}function Oe(e,t){if(t==="")return hr(e);{let n=e,i=_r(n,t);return q(i,v)}}function tt(e){let t=Q(e);return t}function Pn(e,t){if(e instanceof Z||e instanceof WeakMap||e instanceof Map){let n={},i=e.get(t,n);return i===n?new h(new $):new h(new m(i))}let r=Number.isInteger(t);if(r&&t>=0&&t<8&&e instanceof L){let n=0;for(let i of e){if(n===t)return new h(new m(i));n++}return new _("Indexable")}return r&&Array.isArray(e)||e&&typeof e=="object"||e&&Object.getPrototypeOf(e)===Object.prototype?t in e?new h(new m(e[t])):new h(new $):new _(r?"Indexable":"Dict")}function Dn(e,t,r,n,i){if(!(e instanceof L||Array.isArray(e))){let o=new de("List",P(e),i);return[i,L.fromArray([o])]}let s=[];for(let o of e){let u=t(o),[l,a]=u;if(a instanceof _e){let[p,f]=r(u,n.toString());return[i,f]}s.push(l),n++}return[L.fromArray(s),i]}function Rn(e){return Number.isInteger(e)?new h(e):new _(0)}function Fn(e){return typeof e=="string"?new h(e):new _(0)}var de=class extends d{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}},le=class extends d{constructor(t){super(),this.function=t}};function Mr(e,t){let r=t.function(e),n=r[0],i=r[1];return i.hasLength(0)?new h(n):new _(i)}function Gn(e){return new le(t=>[e,c([])])}function Vs(e,t){return new le(r=>{let n=e.function(r),i=n[0],s=n[1];return[t(i),s]})}function Js(e,t,r){for(;;){let n=e,i=t,s=r;if(s.hasLength(0))return i;{let o=s.head,u=s.tail,l=o.function(n),a=l;if(l[1].hasLength(0))return a;e=n,t=i,r=u}}}function Ys(e,t){return new le(r=>{let n=e.function(r),i=n;return n[1].hasLength(0)?i:Js(r,i,t)})}function Hn(e,t,r){let n=r(e);return n.isOk()?[n[0],c([])]:[n[0],c([new de(t,P(e),c([]))])]}function Ks(e){return Hn(e,"Int",Rn)}var kt=new le(Ks);function Xs(e){return Hn(e,"String",Fn)}var ze=new le(Xs);function Vn(e){return new le(t=>Dn(t,e.function,(r,n)=>bt(r,c([n])),0,c([])))}function bt(e,t){let r=Ys(ze,c([Vs(kt,T)])),n=q(t,s=>{let o=s,u=Mr(o,r);return u.isOk()?u[0]:"<"+P(o)+">"}),i=q(e[1],s=>{let o=s;return new de(o.expected,o.found,fe(n,s.path))});return[e[0],i]}function Zs(e,t,r,n,i){for(;;){let s=e,o=t,u=r,l=n,a=i;if(s.hasLength(0)){let p=u(l);return bt(p,F(o))}else{let p=s.head,f=s.tail,g=Pn(l,p);if(g.isOk()&&g[0]instanceof m){let N=g[0][0];e=f,t=w(p,o),r=u,n=N,i=a}else{if(g.isOk()&&g[0]instanceof $)return a(l,w(p,o));{let N=g[0],ht=[u(l)[0],c([new de(N,P(l),c([]))])];return bt(ht,F(o))}}}}}function Qs(e,t,r){return new le(n=>{let i=Zs(e,c([]),t.function,n,(p,f)=>{let C=[t.function(p)[0],c([new de("Field","Nothing",c([]))])];return bt(C,F(f))}),s=i[0],o=i[1],u=r(s).function(n),l=u[0],a=u[1];return[l,fe(o,a)]})}function Le(e,t,r){return Qs(c([e]),t,r)}function je(e,t,r){return e?t:r()}function Yn(e){try{let t=JSON.parse(e);return new h(t)}catch(t){return new _(ro(t,e))}}function ro(e,t){return no(e)?new St:io(e,t)}function no(e){return/((unexpected (end|eof))|(end of data)|(unterminated string)|(json( parse error|\.parse)\: expected '(\:|\}|\])'))/i.test(e.message)}function io(e,t){let r=[so,oo,uo,lo];for(let n of r){let i=n(e,t);if(i)return i}return new me("",0)}function so(e){let r=/unexpected token '(.)', ".+" is not valid JSON/i.exec(e.message);if(!r)return null;let n=Lt(r[1]);return new me(n,-1)}function oo(e){let r=/unexpected token (.) in JSON at position (\d+)/i.exec(e.message);if(!r)return null;let n=Lt(r[1]),i=Number(r[2]);return new me(n,i)}function lo(e,t){let n=/(unexpected character|expected .*) at line (\d+) column (\d+)/i.exec(e.message);if(!n)return null;let i=Number(n[2]),s=Number(n[3]),o=ao(i,s,t),u=Lt(t[o]);return new me(u,o)}function uo(e){let r=/unexpected (identifier|token) "(.)"/i.exec(e.message);if(!r)return null;let n=Lt(r[2]);return new me(n,0)}function Lt(e){return"0x"+e.charCodeAt(0).toString(16).toUpperCase()}function ao(e,t,r){if(e===1)return t-1;let n=1,i=0;return r.split("").find((s,o)=>(s===`
`&&(n+=1),n===e?(i=o+t,!0):!1)),i}var St=class extends d{},me=class extends d{constructor(t){super(),this[0]=t}};var Ur=class extends d{constructor(t){super(),this[0]=t}};function co(e,t){return U(Yn(e),r=>{let n=Mr(r,t);return wt(n,i=>new Ur(i))})}function Kn(e,t){return co(e,t)}var rt=class extends d{constructor(t){super(),this.all=t}};function Xn(e){return new rt(c([t=>e(t.dispatch,t.emit,t.select,t.root)]))}function vt(e){return Xn((t,r,n,i)=>e(t))}function M(){return new rt(c([]))}function Zn(e){return new rt(ce(e,c([]),(t,r)=>{let n=r.all;return fe(t,n)}))}var qe=class extends d{constructor(t){super(),this.content=t}},A=class extends d{constructor(t,r,n,i,s,o,u){super(),this.key=t,this.namespace=r,this.tag=n,this.attrs=i,this.children=s,this.self_closing=o,this.void=u}},nt=class extends d{constructor(t){super(),this.subtree=t}},Be=class extends d{constructor(t,r,n){super(),this[0]=t,this[1]=r,this.as_property=n}},it=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}};function wo(e){if(e instanceof Be)return new _(void 0);{let t=e[0],r=e[1],n=Ir(t,2);return new h([n,r])}}function xo(e,t,r){return pr(e,t,(n,i,s)=>{let o=r+"-"+T(s);return Qn(i,n,o)})}function Qn(e,t,r){for(;;){let n=e,i=t,s=r;if(n instanceof qe)return i;if(n instanceof nt){let o=n.subtree;e=o(),t=i,r=s}else{let o=n.attrs,u=n.children,l=ce(o,i,(a,p)=>{let f=wo(p);if(f.isOk()){let g=f[0][0],N=f[0][1];return ve(a,s+"-"+g,N)}else return a});return xo(u,l,s)}}}function ei(e){return Qn(e,J(),"0")}function st(e,t){return new Be(e,t,!1)}function ri(e,t){return new it("on"+e,t)}function ee(e){return st("style",ce(e,"",(t,r)=>{let n=r[0],i=r[1];return t+n+":"+i+";"}))}function ni(e){return st("type",e)}function ii(e){return st("value",e)}function si(e){return st("placeholder",e)}function oi(e){return st("href",e)}function ue(e,t,r){return e==="area"?new A("","",e,t,c([]),!1,!0):e==="base"?new A("","",e,t,c([]),!1,!0):e==="br"?new A("","",e,t,c([]),!1,!0):e==="col"?new A("","",e,t,c([]),!1,!0):e==="embed"?new A("","",e,t,c([]),!1,!0):e==="hr"?new A("","",e,t,c([]),!1,!0):e==="img"?new A("","",e,t,c([]),!1,!0):e==="input"?new A("","",e,t,c([]),!1,!0):e==="link"?new A("","",e,t,c([]),!1,!0):e==="meta"?new A("","",e,t,c([]),!1,!0):e==="param"?new A("","",e,t,c([]),!1,!0):e==="source"?new A("","",e,t,c([]),!1,!0):e==="track"?new A("","",e,t,c([]),!1,!0):e==="wbr"?new A("","",e,t,c([]),!1,!0):new A("","",e,t,r,!1,!1)}function H(e){return new qe(e)}var Fr=class extends d{constructor(t){super(),this.dict=t}};function ui(){return new Fr(J())}var At=class extends d{constructor(t){super(),this[0]=t}},zt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},jt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}};function ai(e){return k(e.created,J())&&k(e.removed,ui())&&k(e.updated,J())}var Et=class extends d{constructor(t){super(),this[0]=t}},qt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},ot=class extends d{constructor(t){super(),this[0]=t}},te=class extends d{constructor(t){super(),this[0]=t}},lt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},Bt=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}};var ut=class extends d{},Ct=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},Tt=class extends d{constructor(t){super(),this[0]=t}},Nt=class extends d{constructor(t){super(),this[0]=t}};globalThis.customElements&&!globalThis.customElements.get("lustre-fragment")&&globalThis.customElements.define("lustre-fragment",class extends HTMLElement{constructor(){super()}});function Gr(e,t,r){let n,i=[{prev:e,next:t,parent:e.parentNode}];for(;i.length;){let{prev:s,next:o,parent:u}=i.pop();for(;o.subtree!==void 0;)o=o.subtree();if(o.content!==void 0)if(s)if(s.nodeType===Node.TEXT_NODE)s.textContent!==o.content&&(s.textContent=o.content),n??=s;else{let l=document.createTextNode(o.content);u.replaceChild(l,s),n??=l}else{let l=document.createTextNode(o.content);u.appendChild(l),n??=l}else if(o.tag!==void 0){let l=Oo({prev:s,next:o,dispatch:r,stack:i});s?s!==l&&u.replaceChild(l,s):u.appendChild(l),n??=l}}return n}function Oo({prev:e,next:t,dispatch:r,stack:n}){let i=t.namespace||"http://www.w3.org/1999/xhtml",s=e&&e.nodeType===Node.ELEMENT_NODE&&e.localName===t.tag&&e.namespaceURI===(t.namespace||"http://www.w3.org/1999/xhtml"),o=s?e:i?document.createElementNS(i,t.tag):document.createElement(t.tag),u;if(at.has(o))u=at.get(o);else{let y=new Map;at.set(o,y),u=y}let l=s?new Set(u.keys()):null,a=s?new Set(Array.from(e.attributes,y=>y.name)):null,p=null,f=null,g=null;if(s&&t.tag==="textarea"){let y=t.children[Symbol.iterator]().next().value?.content;y!==void 0&&(o.value=y)}let N=[];for(let y of t.attrs){let b=y[0],j=y[1];if(y.as_property)o[b]!==j&&(o[b]=j),s&&a.delete(b);else if(b.startsWith("on")){let V=b.slice(2),ar=r(j,V==="input");u.has(V)||o.addEventListener(V,ft),u.set(V,ar),s&&l.delete(V)}else if(b.startsWith("data-lustre-on-")){let V=b.slice(15),ar=r(Lo);u.has(V)||o.addEventListener(V,ft),u.set(V,ar),o.setAttribute(b,j),s&&(l.delete(V),a.delete(b))}else b.startsWith("delegate:data-")||b.startsWith("delegate:aria-")?(o.setAttribute(b,j),N.push([b.slice(10),j])):b==="class"?p=p===null?j:p+" "+j:b==="style"?f=f===null?j:f+j:b==="dangerous-unescaped-html"?g=j:(o.getAttribute(b)!==j&&o.setAttribute(b,j),(b==="value"||b==="selected")&&(o[b]=j),s&&a.delete(b))}if(p!==null&&(o.setAttribute("class",p),s&&a.delete("class")),f!==null&&(o.setAttribute("style",f),s&&a.delete("style")),s){for(let y of a)o.removeAttribute(y);for(let y of l)u.delete(y),o.removeEventListener(y,ft)}if(t.tag==="slot"&&window.queueMicrotask(()=>{for(let y of o.assignedElements())for(let[b,j]of N)y.hasAttribute(b)||y.setAttribute(b,j)}),t.key!==void 0&&t.key!=="")o.setAttribute("data-lustre-key",t.key);else if(g!==null)return o.innerHTML=g,o;let C=o.firstChild,lr=null,ht=null,fn=null,ur=It(t).next().value;if(s&&ur!==void 0&&ur.key!==void 0&&ur.key!==""){lr=new Set,ht=fi(e),fn=fi(t);for(let y of It(t))C=So(C,y,o,n,fn,ht,lr)}else for(let y of It(t))n.unshift({prev:C,next:y,parent:o}),C=C?.nextSibling;for(;C;){let y=C.nextSibling;o.removeChild(C),C=y}return o}var at=new WeakMap;function ft(e){let t=e.currentTarget;if(!at.has(t)){t.removeEventListener(e.type,ft);return}let r=at.get(t);if(!r.has(e.type)){t.removeEventListener(e.type,ft);return}r.get(e.type)(e)}function Lo(e){let t=e.currentTarget,r=t.getAttribute(`data-lustre-on-${e.type}`),n=JSON.parse(t.getAttribute("data-lustre-data")||"{}"),i=JSON.parse(t.getAttribute("data-lustre-include")||"[]");switch(e.type){case"input":case"change":i.push("target.value");break}return{tag:r,data:i.reduce((s,o)=>{let u=o.split(".");for(let l=0,a=s,p=e;l<u.length;l++)l===u.length-1?a[u[l]]=p[u[l]]:(a[u[l]]??={},p=p[u[l]],a=a[u[l]]);return s},{data:n})}}function fi(e){let t=new Map;if(e)for(let r of It(e)){let n=r?.key||r?.getAttribute?.("data-lustre-key");n&&t.set(n,r)}return t}function So(e,t,r,n,i,s,o){for(;e&&!i.has(e.getAttribute("data-lustre-key"));){let l=e.nextSibling;r.removeChild(e),e=l}if(s.size===0)return n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e;if(o.has(t.key))return console.warn(`Duplicate key found in Lustre vnode: ${t.key}`),n.unshift({prev:null,next:t,parent:r}),e;o.add(t.key);let u=s.get(t.key);if(!u&&!e)return n.unshift({prev:null,next:t,parent:r}),e;if(!u&&e!==null){let l=document.createTextNode("");return r.insertBefore(l,e),n.unshift({prev:l,next:t,parent:r}),e}return!u||u===e?(n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e):(r.insertBefore(u,e),n.unshift({prev:u,next:t,parent:r}),e)}function*It(e){for(let t of e.children)yield*ci(t)}function*ci(e){e.subtree!==void 0?yield*ci(e.subtree()):yield e}var Hr=class e{static start({init:t,update:r,view:n},i,s){if(!ct())return new _(new pt);let o=i instanceof HTMLElement?i:document.querySelector(i);if(!o)return new _(new Wt(i));let u=new e(o,t(s),r,n);return new h(l=>u.send(l))}constructor(t,[r,n],i,s){this.root=t,this.#e=r,this.#s=i,this.#r=s,this.#t=window.setTimeout(()=>this.#n(n.all.toArray(),!0),0)}root;send(t){if(t instanceof ot){if(t[0]instanceof Nt){this.#t=window.clearTimeout(this.#t),this.#i=[],this.#e=t[0][0];let r=this.#r(this.#e),n=(s,o=!1)=>u=>{let l=s(u);l instanceof h&&this.send(new te(l[0],o))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));Gr(i,r,n)}}else if(t instanceof te){let r=t[0],n=t[1]??!1;this.#i.push(r),n?(this.#t=window.clearTimeout(this.#t),this.#n()):this.#t||(this.#t=window.setTimeout(()=>this.#n()))}else if(t instanceof lt){let r=t[0],n=t[1];this.root.dispatchEvent(new CustomEvent(r,{detail:n,bubbles:!0,composed:!0}))}else if(t instanceof ut)for(this.#t=window.clearTimeout(this.#t),this.#e=null,this.#s=null,this.#r=null,this.#i=null;this.root.firstChild;)this.root.firstChild.remove()}#e;#s;#r;#i=[];#t;#n(t=[]){this.#t=void 0,this.#o(t);let r=this.#r(this.#e),n=(s,o=!1)=>u=>{let l=s(u);l instanceof h&&this.send(new te(l[0],o))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));Gr(i,r,n)}#o(t=[]){for(;this.#i.length>0;){let r=this.#i.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;){let r=t.shift(),n=u=>this.send(new te(u)),i=(u,l)=>this.root.dispatchEvent(new CustomEvent(u,{detail:l,bubbles:!0,composed:!0})),s=()=>{},o=this.root;r({dispatch:n,emit:i,select:s,root:o})}this.#i.length>0&&this.#o(t)}},pi=Hr.start;var Vr=class e{static start({init:t,update:r,view:n,on_attribute_change:i},s){let o=new e(t(s),r,n,i);return new h(u=>o.send(u))}constructor([t,r],n,i,s){this.#e=t,this.#s=n,this.#i=i,this.#t=i(t),this.#u=s,this.#n=new Map,this.#o=ei(this.#t),this.#l(r.all.toArray())}send(t){if(t instanceof Et){for(let r of t[0]){let n=this.#u.get(r[0]);if(!n)continue;let i=n(r[1]);i instanceof _||this.#r.push(i)}this.#l()}else if(t instanceof qt)this.#r=this.#r.concat(t[0].toArray()),this.#l(t[1].all.toArray());else if(!(t instanceof ot))if(t instanceof te)this.#r.push(t[0]),this.#l();else if(t instanceof lt){let r=new zt(t[0],t[1]);for(let[n,i]of this.#n)i(r)}else if(t instanceof Bt){let r=this.#o.get(t[0]);if(!r)return;let n=r(t[1]);if(n instanceof _)return;this.#r.push(n[0]),this.#l()}else if(t instanceof Ct){let r=cr(this.#u),n=new jt(r,this.#t);this.#n=this.#n.set(t[0],t[1]),t[1](n)}else t instanceof Tt&&(this.#n=this.#n.delete(t[0]))}#e;#s;#r;#i;#t;#n;#o;#u;#l(t=[]){this.#a(t);let r=this.#i(this.#e),n=elements(this.#t,r);if(!ai(n)){let i=new At(n);for(let[s,o]of this.#n)o(i)}this.#t=r,this.#o=n.handlers}#a(t=[]){for(;this.#r.length>0;){let r=this.#r.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;)t.shift()({dispatch:u=>this.send(new te(u)),emit:(u,l)=>this.root.dispatchEvent(new CustomEvent(u,{detail:l,bubbles:!0,composed:!0})),select:()=>{},root:null});this.#r.length>0&&this.#a(t)}},vo=Vr.start,ct=()=>globalThis.window&&window.document;var Jr=class extends d{constructor(t,r,n,i){super(),this.init=t,this.update=r,this.view=n,this.on_attribute_change=i}};var Wt=class extends d{constructor(t){super(),this.selector=t}},pt=class extends d{};function di(e,t,r){return new Jr(e,t,r,new $)}function mi(e,t,r){return je(!ct(),new _(new pt),()=>pi(e,t,r))}function _i(e,t){return ue("h3",e,t)}function Ce(e,t){return ue("div",e,t)}function Mt(e,t){return ue("p",e,t)}function $i(e,t){return ue("pre",e,t)}function wi(e,t){return ue("a",e,t)}function xi(e,t){return ue("button",e,t)}function gi(e){return ue("input",e,c([]))}function yi(e,t){return ri(e,t)}function bi(e){return yi("click",t=>new h(e))}function zo(e){let t=e;return $r("target",$r("value",gn))(t)}function ki(e){return yi("input",t=>{let r=zo(t);return ge(r,e)})}var x=class extends d{constructor(t,r,n,i,s,o,u){super(),this.scheme=t,this.userinfo=r,this.host=n,this.port=i,this.path=s,this.query=o,this.fragment=u}};function Bo(e){return 48>=e&&e<=57||65>=e&&e<=90||97>=e&&e<=122||e===58||e===46}function ne(e,t){return new h((()=>{let r=t;return new x(r.scheme,r.userinfo,r.host,r.port,r.path,r.query,new m(e))})())}function Co(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s.startsWith("#")&&u===0){let l=s.slice(1);return ne(l,o)}else if(s.startsWith("#")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(f.scheme,f.userinfo,f.host,f.port,f.path,new m(a),f.fragment)})();return ne(l,p)}else{if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,l.host,l.port,l.path,new m(i),l.fragment)})());{let a=ke(s)[1];e=i,t=a,r=o,n=u+1}}}}function he(e,t){return Co(e,e,t,0)}function To(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s.startsWith("?")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(f.scheme,f.userinfo,f.host,f.port,a,f.query,f.fragment)})();return he(l,p)}else if(s.startsWith("#")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(f.scheme,f.userinfo,f.host,f.port,a,f.query,f.fragment)})();return ne(l,p)}else{if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,l.host,l.port,i,l.query,l.fragment)})());{let a=ke(s)[1];e=i,t=a,r=o,n=u+1}}}}function Ne(e,t){return To(e,e,t,0)}function re(e,t,r){for(;;){let n=e,i=t,s=r;if(n.startsWith("0"))e=n.slice(1),t=i,r=s*10;else if(n.startsWith("1"))e=n.slice(1),t=i,r=s*10+1;else if(n.startsWith("2"))e=n.slice(1),t=i,r=s*10+2;else if(n.startsWith("3"))e=n.slice(1),t=i,r=s*10+3;else if(n.startsWith("4"))e=n.slice(1),t=i,r=s*10+4;else if(n.startsWith("5"))e=n.slice(1),t=i,r=s*10+5;else if(n.startsWith("6"))e=n.slice(1),t=i,r=s*10+6;else if(n.startsWith("7"))e=n.slice(1),t=i,r=s*10+7;else if(n.startsWith("8"))e=n.slice(1),t=i,r=s*10+8;else if(n.startsWith("9"))e=n.slice(1),t=i,r=s*10+9;else if(n.startsWith("?")){let o=n.slice(1),u=(()=>{let l=i;return new x(l.scheme,l.userinfo,l.host,new m(s),l.path,l.query,l.fragment)})();return he(o,u)}else if(n.startsWith("#")){let o=n.slice(1),u=(()=>{let l=i;return new x(l.scheme,l.userinfo,l.host,new m(s),l.path,l.query,l.fragment)})();return ne(o,u)}else if(n.startsWith("/")){let o=(()=>{let u=i;return new x(u.scheme,u.userinfo,u.host,new m(s),u.path,u.query,u.fragment)})();return Ne(n,o)}else return n===""?new h((()=>{let o=i;return new x(o.scheme,o.userinfo,o.host,new m(s),o.path,o.query,o.fragment)})()):new _(void 0)}}function Ut(e,t){if(e.startsWith(":0")){let r=e.slice(2);return re(r,t,0)}else if(e.startsWith(":1")){let r=e.slice(2);return re(r,t,1)}else if(e.startsWith(":2")){let r=e.slice(2);return re(r,t,2)}else if(e.startsWith(":3")){let r=e.slice(2);return re(r,t,3)}else if(e.startsWith(":4")){let r=e.slice(2);return re(r,t,4)}else if(e.startsWith(":5")){let r=e.slice(2);return re(r,t,5)}else if(e.startsWith(":6")){let r=e.slice(2);return re(r,t,6)}else if(e.startsWith(":7")){let r=e.slice(2);return re(r,t,7)}else if(e.startsWith(":8")){let r=e.slice(2);return re(r,t,8)}else if(e.startsWith(":9")){let r=e.slice(2);return re(r,t,9)}else{if(e.startsWith(":"))return new _(void 0);if(e.startsWith("?")){let r=e.slice(1);return he(r,t)}else if(e.startsWith("#")){let r=e.slice(1);return ne(r,t)}else return e.startsWith("/")?Ne(e,t):e===""?new h(t):new _(void 0)}}function Oi(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,new m(i),l.port,l.path,l.query,l.fragment)})());if(s.startsWith(":")){let l=z(i,0,u),a=(()=>{let p=o;return new x(p.scheme,p.userinfo,new m(l),p.port,p.path,p.query,p.fragment)})();return Ut(s,a)}else if(s.startsWith("/")){let l=z(i,0,u),a=(()=>{let p=o;return new x(p.scheme,p.userinfo,new m(l),p.port,p.path,p.query,p.fragment)})();return Ne(s,a)}else if(s.startsWith("?")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(f.scheme,f.userinfo,new m(a),f.port,f.path,f.query,f.fragment)})();return he(l,p)}else if(s.startsWith("#")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(f.scheme,f.userinfo,new m(a),f.port,f.path,f.query,f.fragment)})();return ne(l,p)}else{let a=ke(s)[1];e=i,t=a,r=o,n=u+1}}}function No(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,new m(s),l.port,l.path,l.query,l.fragment)})());if(s.startsWith("]")&&u===0){let l=s.slice(1);return Ut(l,o)}else if(s.startsWith("]")){let l=s.slice(1),a=z(i,0,u+1),p=(()=>{let f=o;return new x(f.scheme,f.userinfo,new m(a),f.port,f.path,f.query,f.fragment)})();return Ut(l,p)}else{if(s.startsWith("/")&&u===0)return Ne(s,o);if(s.startsWith("/")){let l=z(i,0,u),a=(()=>{let p=o;return new x(p.scheme,p.userinfo,new m(l),p.port,p.path,p.query,p.fragment)})();return Ne(s,a)}else if(s.startsWith("?")&&u===0){let l=s.slice(1);return he(l,o)}else if(s.startsWith("?")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(f.scheme,f.userinfo,new m(a),f.port,f.path,f.query,f.fragment)})();return he(l,p)}else if(s.startsWith("#")&&u===0){let l=s.slice(1);return ne(l,o)}else if(s.startsWith("#")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(f.scheme,f.userinfo,new m(a),f.port,f.path,f.query,f.fragment)})();return ne(l,p)}else{let l=ke(s),a=l[0],p=l[1];if(Bo(a))e=i,t=p,r=o,n=u+1;else return Oi(i,i,o,0)}}}}function Io(e,t){return No(e,e,t,0)}function Wo(e,t){return Oi(e,e,t,0)}function Te(e,t){if(e.startsWith("["))return Io(e,t);if(e.startsWith(":")){let r=(()=>{let n=t;return new x(n.scheme,n.userinfo,new m(""),n.port,n.path,n.query,n.fragment)})();return Ut(e,r)}else return e===""?new h((()=>{let r=t;return new x(r.scheme,r.userinfo,new m(""),r.port,r.path,r.query,r.fragment)})()):Wo(e,t)}function Mo(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s.startsWith("@")&&u===0){let l=s.slice(1);return Te(l,o)}else if(s.startsWith("@")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(f.scheme,new m(a),f.host,f.port,f.path,f.query,f.fragment)})();return Te(l,p)}else{if(s==="")return Te(i,o);if(s.startsWith("/"))return Te(i,o);if(s.startsWith("?"))return Te(i,o);if(s.startsWith("#"))return Te(i,o);{let a=ke(s)[1];e=i,t=a,r=o,n=u+1}}}}function Uo(e,t){return Mo(e,e,t,0)}function Yr(e,t){if(e==="//")return new h((()=>{let r=t;return new x(r.scheme,r.userinfo,new m(""),r.port,r.path,r.query,r.fragment)})());if(e.startsWith("//")){let r=e.slice(2);return Uo(r,t)}else return Ne(e,t)}function Po(e,t,r,n){for(;;){let i=e,s=t,o=r,u=n;if(s.startsWith("/")&&u===0)return Yr(s,o);if(s.startsWith("/")){let l=z(i,0,u),a=(()=>{let p=o;return new x(new m(G(l)),p.userinfo,p.host,p.port,p.path,p.query,p.fragment)})();return Yr(s,a)}else if(s.startsWith("?")&&u===0){let l=s.slice(1);return he(l,o)}else if(s.startsWith("?")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(new m(G(a)),f.userinfo,f.host,f.port,f.path,f.query,f.fragment)})();return he(l,p)}else if(s.startsWith("#")&&u===0){let l=s.slice(1);return ne(l,o)}else if(s.startsWith("#")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(new m(G(a)),f.userinfo,f.host,f.port,f.path,f.query,f.fragment)})();return ne(l,p)}else{if(s.startsWith(":")&&u===0)return new _(void 0);if(s.startsWith(":")){let l=s.slice(1),a=z(i,0,u),p=(()=>{let f=o;return new x(new m(G(a)),f.userinfo,f.host,f.port,f.path,f.query,f.fragment)})();return Yr(l,p)}else{if(s==="")return new h((()=>{let l=o;return new x(l.scheme,l.userinfo,l.host,l.port,i,l.query,l.fragment)})());{let a=ke(s)[1];e=i,t=a,r=o,n=u+1}}}}}function Pt(e){let t=(()=>{let u=e.fragment;if(u instanceof m){let l=u[0];return c(["#",l])}else return c([])})(),r=(()=>{let u=e.query;if(u instanceof m){let l=u[0];return w("?",w(l,t))}else return t})(),n=w(e.path,r),i=(()=>{let u=e.host,l=Br(e.path,"/");if(u instanceof m&&!l&&u[0]!==""){let a=u[0];return w("/",n)}else return n})(),s=(()=>{let u=e.host,l=e.port;if(u instanceof m&&l instanceof m){let a=l[0];return w(":",w(T(a),i))}else return i})(),o=(()=>{let u=e.scheme,l=e.userinfo,a=e.host;if(u instanceof m&&l instanceof m&&a instanceof m){let p=u[0],f=l[0],g=a[0];return w(p,w("://",w(f,w("@",w(g,s)))))}else if(u instanceof m&&l instanceof $&&a instanceof m){let p=u[0],f=a[0];return w(p,w("://",w(f,s)))}else if(u instanceof m&&l instanceof m&&a instanceof $){let p=u[0];return w(p,w(":",s))}else if(u instanceof m&&l instanceof $&&a instanceof $){let p=u[0];return w(p,w(":",s))}else if(u instanceof $&&l instanceof $&&a instanceof m){let p=a[0];return w("//",w(p,s))}else return s})();return Nr(o)}var Do=new x(new $,new $,new $,new $,"",new $,new $);function Li(e){return Po(e,e,Do,0)}var Ie=class extends d{},dt=class extends d{},Dt=class extends d{},Rt=class extends d{},Ft=class extends d{},Gt=class extends d{},Ht=class extends d{},Vt=class extends d{},Jt=class extends d{};var Yt=class extends d{},mt=class extends d{};function Si(e){return e instanceof Ht?"connect":e instanceof Ft?"delete":e instanceof Ie?"get":e instanceof Dt?"head":e instanceof Vt?"options":e instanceof Jt?"patch":e instanceof dt?"post":e instanceof Rt?"put":e instanceof Gt?"trace":e[0]}function vi(e){return e instanceof Yt?"http":"https"}function Ai(e){let t=G(e);return t==="http"?new h(new Yt):t==="https"?new h(new mt):new _(void 0)}var Xr=class extends d{constructor(t,r,n,i,s,o,u,l){super(),this.method=t,this.headers=r,this.body=n,this.scheme=i,this.host=s,this.port=o,this.path=u,this.query=l}};function ji(e){return new x(new m(vi(e.scheme)),new $,new m(e.host),e.port,e.path,e.query,new $)}function Jo(e){return U((()=>{let t=e.scheme,r=mn(t,"");return Ai(r)})(),t=>U((()=>{let r=e.host;return Ge(r,void 0)})(),r=>{let n=new Xr(new Ie,c([]),"",t,r,e.port,e.path,e.query);return new h(n)}))}function Ei(e){let r=Li(e);return U(r,Jo)}var ae=class extends d{constructor(t,r,n){super(),this.status=t,this.headers=r,this.body=n}};var We=class e{constructor(t){this.promise=t}static wrap(t){return t instanceof Promise?new e(t):t}static unwrap(t){return t instanceof e?t.promise:t}};function Kt(e){return Promise.resolve(We.wrap(e))}function qi(e,t){return e.then(r=>t(We.unwrap(r)))}function Xt(e,t){return e.then(r=>We.wrap(t(We.unwrap(r))))}function Zr(e,t){return e.catch(r=>t(r))}function Bi(e,t){return Xt(e,n=>(t(n),n))}function Zt(e,t){return qi(e,n=>{if(n.isOk()){let i=n[0];return t(i)}else{let i=n[0];return Kt(new _(i))}})}async function Ti(e){try{return new h(await fetch(e))}catch(t){return new _(new Qt(t.toString()))}}function Ni(e){return new ae(e.status,L.fromArray([...e.headers]),e)}function Ii(e){let t=Pt(ji(e)),r=Si(e.method).toUpperCase(),n={headers:Xo(e.headers),method:r};return r!=="GET"&&r!=="HEAD"&&(n.body=e.body),new globalThis.Request(t,n)}function Xo(e){let t=new globalThis.Headers;for(let[r,n]of e)t.append(r.toLowerCase(),n);return t}async function Qr(e){let t;try{t=await e.body.text()}catch{return new _(new er)}return new h(e.withFields({body:t}))}var Qt=class extends d{constructor(t){super(),this[0]=t}},er=class extends d{};function Wi(e){let r=Ii(e),n=Ti(r);return Zt(n,i=>Kt(new h(Ni(i))))}var en=class extends d{constructor(t){super(),this[0]=t}},tn=class extends d{constructor(t){super(),this[0]=t}},rn=class extends d{constructor(t){super(),this[0]=t}},tr=class extends d{},nn=class extends d{},sn=class extends d{constructor(t,r){super(),this[0]=t,this[1]=r}},on=class extends d{},ln=class extends d{constructor(t){super(),this.run=t}};function Qo(e,t,r){let n=Wi(e),i=Zt(n,Qr),s=Xt(i,u=>{if(u.isOk()){let l=u[0];return t.run(new h(l))}else return t.run(new _(new tr))}),o=Zr(s,u=>t.run(new _(new tr)));Bi(o,r)}function Mi(e,t){return vt(r=>{let n=Ei(e);if(n.isOk()){let i=n[0];return Qo(i,t,r)}else return r(t.run(new _(new en(e))))})}function el(e){if(e instanceof ae&&200<=e.status&&e.status<=299){let t=e.status,r=e.body;return new h(r)}else{if(e instanceof ae&&e.status===401)return new _(new on);if(e instanceof ae&&e.status===404)return new _(new nn);if(e instanceof ae&&e.status===500){let t=e.body;return new _(new tn(t))}else{let t=e.status,r=e.body;return new _(new sn(t,r))}}}function Ui(e,t){return new ln(r=>{let i=U(r,el),s=U(i,o=>{let u=Kn(o,e);if(u.isOk()){let l=u[0];return new h(l)}else{let l=u[0];return new _(new rn(l))}});return t(s)})}var Pi=window?.location?.href,un=()=>Pi?new h(rl(new URL(Pi))):new _(void 0);var Di=e=>{window.history.pushState({},"",Pt(e)),window.requestAnimationFrame(()=>{e.fragment[0]&&document.getElementById(e.fragment[0])?.scrollIntoView()}),window.dispatchEvent(new CustomEvent("modem-push",{detail:e}))};var rl=e=>new x(e.protocol?new m(e.protocol.slice(0,-1)):new $,new $,e.hostname?new m(e.hostname):new $,e.port?new m(Number(e.port)):new $,e.pathname,e.search?new m(e.search.slice(1)):new $,e.hash?new m(e.hash.slice(1)):new $);var il=new x(new $,new $,new $,new $,"",new $,new $);function Ri(e,t,r){return vt(n=>je(!ct(),void 0,()=>Di((()=>{let i=il;return new x(i.scheme,i.userinfo,i.host,i.port,e,t,r)})())))}var an=class extends d{constructor(t,r,n,i,s,o){super(),this.id=t,this.track_name=r,this.artist_name=n,this.album_name=i,this.duration=s,this.plain_lyrics=o}},E=class extends d{constructor(t,r,n){super(),this.search_url=t,this.tracks=r,this.error=n}},rr=class extends d{constructor(t){super(),this[0]=t}},nr=class extends d{},ir=class extends d{constructor(t){super(),this[0]=t}};function ol(){return"https://xueba-9azgj.ondigitalocean.app"}function sr(e){let t=Oe(e,"/");if(O("URL parts: "+oe(t,", ")),t.atLeastLength(5)&&t.tail.tail.tail.head==="track"){let r=t.tail.tail.tail.tail.head,n=Oe(r,"?");if(O("ID parts: "+oe(n,", ")),n.atLeastLength(1)){let i=n.head;return O("Found track ID: "+i),new m(i)}else return O("No ID found in parts"),new $}else return O("URL doesn't match expected format"),new $}function ll(){return Le("id",kt,e=>Le("trackName",ze,t=>Le("artistName",ze,r=>Le("albumName",ze,n=>Le("duration",kt,i=>Le("plainLyrics",ze,s=>Gn(new an(e,t,r,n,i,s))))))))}function or(e){let t=ol()+"/track/"+e;O("Making API request to: "+t);let r=Vn(ll()),n=Ui(r,i=>new ir(i));return Mi(t,n)}function ul(e){O("Initializing app...");let t=un();if(O("Initial URL: "+tt(t)),t.isOk()){let r=t[0];if(O("URI path: "+r.path),O("URI query: "+tt(r.query)),r.path==="/search"){let i=r.query;if(i instanceof m){let s=i[0];O("Search path query: "+s);let o=Ae(s,"=");if(o.isOk()&&o[0][0]==="q"){let u=o[0][1];O("Found URL in search path: "+u);let l=sr(u);if(l instanceof m){let a=l[0];return O("Found track ID: "+a),[new E(u,c([]),new $),or(a)]}else return O("No valid track ID found in search path"),[new E("",c([]),new $),M()]}else return O("Search path query doesn't match expected format"),[new E("",c([]),new $),M()]}else return O("Search path has no query"),[new E("",c([]),new $),M()]}else{let i=r.query;if(i instanceof m){let s=i[0];O("Regular query string: "+s);let o=Ae(s,"=");if(o.isOk()&&o[0][0]==="q"){let u=o[0][1];O("Found URL in regular query: "+u);let l=sr(u);if(l instanceof m){let a=l[0];return O("Found track ID: "+a),[new E(u,c([]),new $),or(a)]}else return O("No valid track ID found"),[new E("",c([]),new $),M()]}else return O("Regular query doesn't match expected format"),[new E("",c([]),new $),M()]}else return O("No query parameter found"),[new E("",c([]),new $),M()]}}else return O("Failed to get initial URL"),[new E("",c([]),new $),M()]}function al(e,t){if(t instanceof rr){let r=t[0],n=sr(r);if(n instanceof m){let i=n[0];return[(()=>{let s=e;return new E(r,s.tracks,s.error)})(),or(i)]}else return[(()=>{let i=e;return new E(r,i.tracks,i.error)})(),M()]}else if(t instanceof nr){let r=sr(e.search_url);if(r instanceof m){let n=r[0],i=Tr(e.search_url,"/","%2F");return[e,Zn(c([or(n),Ri("/search",new m("q="+i),new $)]))]}else return[(()=>{let n=e;return new E(n.search_url,n.tracks,new m("Invalid Spotify URL"))})(),M()]}else if(t instanceof ir&&t[0].isOk()){let r=t[0][0];return[(()=>{let n=e;return new E(n.search_url,r,new $)})(),M()]}else return[(()=>{let r=e;return new E(r.search_url,r.tracks,new m("Failed to fetch tracks"))})(),M()]}function fl(e){let t=c([["padding","20px"]]),r=c([["margin-bottom","20px"]]),n=c([["padding","8px"],["margin-right","10px"],["width","300px"]]),i=c([["padding","8px 16px"]]),s=c([["color","red"],["margin-bottom","10px"]]),o=c([["margin-bottom","20px"],["padding","10px"],["border","1px solid #ccc"],["border-radius","4px"]]),u=c([["white-space","pre-wrap"]]);return Ce(c([ee(t)]),c([Ce(c([ee(r)]),c([gi(c([ni("text"),si("Enter Spotify URL"),ii(e.search_url),ki(l=>new rr(l)),ee(n)])),xi(c([bi(new nr),ee(i)]),c([H("Search")]))])),(()=>{let l=e.error;if(l instanceof m){let a=l[0];return Ce(c([ee(s)]),c([H(a)]))}else return H("")})(),Ce(c([]),q(e.tracks,l=>{let a="plecoapi://x-callback-url/s?q="+l.plain_lyrics;return Ce(c([ee(o)]),c([_i(c([]),c([H(l.track_name)])),Mt(c([]),c([H("Artist: "+l.artist_name)])),Mt(c([]),c([H("Album: "+l.album_name)])),Mt(c([]),c([H("Duration: "+T(l.duration)+" seconds")])),wi(c([oi(a),ee(c([["color","blue"],["text-decoration","underline"]]))]),c([H("Open in Pleco")])),$i(c([ee(u)]),c([H(l.plain_lyrics)]))]))}))]))}function Fi(){let e=di(ul,al,fl),t=mi(e,"#app",void 0);if(!t.isOk())throw Re("let_assert","app",23,"main","Pattern match failed, no pattern matched the value.",{value:t})}Fi();
